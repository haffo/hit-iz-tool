"use strict";angular.module("xml",[]),angular.module("hl7",[]),angular.module("commonServices",[]),angular.module("common",["ngResource","my.resource","xml","hl7"]),angular.module("soap",["common"]),angular.module("cf",["common"]),angular.module("doc",["common"]),angular.module("cb",["common"]),angular.module("envelope",["soap"]),angular.module("connectivity",["soap"]),angular.module("profile-viewer",["common"]),angular.module("tool-directives",[]),angular.module("tool-services",["common"]);var app=angular.module("tool",["ngRoute","ui.bootstrap","ngCookies","ngResource","ngSanitize","ngAnimate","ui.bootstrap","angularBootstrapNavTree","soap","xml","hl7","envelope","connectivity","cf","cb","profile-viewer","ngTreetable","blueimp.fileupload","tool-directives","tool-services","commonServices","smart-table","doc"]);app.config(["$routeProvider","$httpProvider",function(a,b){a.when("/",{templateUrl:"views/home.html"}).when("/home",{templateUrl:"views/home.html"}).when("/testing",{templateUrl:"views/testing/testing.html"}).when("/doc",{templateUrl:"views/documentation/doc.html"}).when("/setting",{templateUrl:"views/setting.html"}).when("/about",{templateUrl:"views/about.html"}).when("/contact",{templateUrl:"views/contact.html"}).otherwise({redirectTo:"/"}),b.responseInterceptors.push("503Interceptor"),b.responseInterceptors.push("sessionTimeoutInterceptor")}]),app.factory("503Interceptor",["$injector","$q","$rootScope",function(a,b,c){return function(a){return a.then(null,function(a){return 503!==a.status?b.reject(a):void c.showError(a)})}}]).factory("sessionTimeoutInterceptor",["$injector","$q","$rootScope",function(a,b,c){return function(a){return a.then(null,function(a){return"The session has expired"!==a.reason?b.reject(a):void c.showError(a)})}}]),app.run(["$rootScope","$location","$modal","TestingSettings","AppInfo",function(a,b,c,d,e){a.appInfo={},a.$watch(function(){return b.path()},function(b){a.setActive(b)}),a.isActive=function(b){return b===a.activePath},a.setActive=function(c){""===c||"/"===c?b.path("/home"):a.activePath=c},a.showError=function(b){var d=c.open({templateUrl:"ErrorDlgDetails.html",controller:"ErrorDetailsCtrl",resolve:{error:function(){return b}}});d.result.then(function(b){a.error=b},function(){})},a.cutString=function(a){return a.length>20&&(a=a.substring(0,20)+"..."),a},(new e).then(function(b){a.appInfo=b}),a.tabs=new Array,a.selectTestingType=function(b){a.tabs[0]=!1,a.tabs[1]=!1,a.tabs[2]=!1,a.tabs[3]=!1,a.tabs[4]=!1,a.tabs[5]=!1,a.activeTab=b,a.tabs[a.activeTab]=!0,d.setActiveTab(a.activeTab)}}]),angular.module("ui.bootstrap.carousel",["ui.bootstrap.transition"]).controller("CarouselController",["$scope","$timeout","$transition","$q",function(){}]).directive("carousel",[function(){return{}}]),angular.module("tool-services").factory("TabSettings",["$rootScope",function(){return{"new":function(a){return{key:a,activeTab:0,getActiveTab:function(){return this.activeTab},setActiveTab:function(a){this.activeTab=a,this.save()},save:function(){sessionStorage.setItem(this.key,this.activeTab)},restore:function(){this.activeTab=null!=sessionStorage.getItem(this.key)&&""!=sessionStorage.getItem(this.key)?parseInt(sessionStorage.getItem(this.key)):0}}}}}]),app.controller("ErrorDetailsCtrl",["$scope","$modalInstance","error",function(a,b,c){a.error=c,a.ok=function(){b.close(a.error)},a.cancel=function(){b.dismiss("cancel")}}]),app.directive("stRatio",function(){return{link:function(a,b,c){var d=+c.stRatio;b.css("width",d+"%")}}}),angular.module("tool-services").factory("AppInfo",["$http","$q",function(a,b){return function(){var c=b.defer();return a.get("api/appInfo").then(function(a){c.resolve(angular.fromJson(a.data))},function(a){c.reject(a.data)}),c.promise}}]),angular.module("tool-services").controller("TableFoundCtrl",["$scope","$modalInstance","table",function(a,b,c){a.table=c,a.tmpTableElements=[].concat(null!=c?c.tableElements:[]),a.cancel=function(){b.dismiss("cancel")}}]),angular.module("my.resource",["ngResource"]).factory("Resource",["$resource",function(a){return function(b,c,d){var e={update:{method:"put",isArray:!1},create:{method:"post"}};d=angular.extend(e,d);var f=a(b,c,d);return f.prototype.$save=function(a,b){return this.id?this.$update(a,b):this.$create(a,b)},f}}]),angular.module("tool-services").factory("TestingSettings",["$rootScope",function(){var a={activeTab:0,getActiveTab:function(){return a.activeTab},setActiveTab:function(b){a.activeTab=b,a.save()},save:function(){sessionStorage.TestingActiveTab=a.activeTab},restore:function(){a.activeTab=null!=sessionStorage.TestingActiveTab&&""!=sessionStorage.TestingActiveTab?parseInt(sessionStorage.TestingActiveTab):0}};return a}]),angular.module("xml").factory("XmlParser",["$http","$q",function(a,b){return function(c){var d=b.defer(),e=angular.fromJson({content:c});return a.post("api/xml/parse",e,{timeout:6e4}).then(function(a){d.resolve(angular.fromJson(a.data))},function(a){d.reject(a.data)}),d.promise}}]),angular.module("xml").factory("XmlFormatter",["$http","$q",function(a,b){return function(c){var d=b.defer(),e=angular.fromJson({content:c});return a.post("api/xml/format",e,{timeout:6e4}).then(function(a){d.resolve(a.data.content)},function(a){d.reject(a.data)}),d.promise}}]),angular.module("xml").factory("XmlNodeFinder",["$rootScope",function(){return{find:function(a,b){var c=a.get_first_branch(),d=a.get_siblings(c);if(d){var e=d[0];return null==e?null:this.findNode(a,e,b.line)}return null},findNode:function(a,b,c){if(b.data.start.line<=c){if(b.data.start.line==c||b.data.end.line==c)return b;var d=a.get_children(b);if(d&&d.length>0)for(var e=0;e<d.length;e++){var f=this.findNode(a,d[e],c);if(null!=f)return f}}return null}}}]),angular.module("xml").factory("XmlCursorUtils",["$rootScope",function(){return{createCoordinate:function(a,b){try{return angular.fromJson({start:a,end:b})}catch(c){}}}}]),angular.module("xml").factory("XmlEditorUtils",["$rootScope","$http","$q",function(){return{select:function(a,b){b.doc.setSelection({line:a.start.line-1,ch:a.start.index},{line:a.end.line-1,ch:a.end.index})},isXML:function(a){return a.startsWith("<")}}}]),angular.module("xml").factory("XmlTreeUtils",["$rootScope","$http","$q","XmlNodeFinder","XmlCursorUtils",function(a,b,c,d,e){return{selectNode:function(a,b){var c=d.find(a,b);if(null!==c){var e=a.get_selected_branch();e!==c&&(a.collapse_all(),a.select_branch(c),a.expand_branch(c),b.start=c.data.start,b.end=c.data.end)}},getCoordinate:function(a){return e.createCoordinate(a.data.start,a.data.end)},setCoordinate:function(a,b){try{var c=this.getCoordinate(a);null!==c&&(b.start=c.start,b.end=c.end,b.notify())}catch(d){}},expandTree:function(a){if(a){var b=a.get_first_branch(),c=a.get_siblings(b);if(c)for(var d=0;d<c.length;d++){var e=c[d];a.expand_branch(e);for(var f=a.get_children(e),g=0;g<f.length;g++){var h=f[g];a.expand_branch(h);for(var i=a.get_children(h),j=0;j<i.length;j++){var k=i[j];a.expand_branch(k)}}}}}}}]),angular.module("soap").factory("SoapValidationReportGenerator",["$http","$q",function(a,b){return function(c,d){var e=b.defer();return a({url:"api/soap/report/generate/"+d,data:$.param({xmlReport:c}),headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"POST",timeout:6e4}).success(function(a){e.resolve(angular.fromJson(a))}).error(function(a){e.reject(a)}),e.promise}}]),angular.module("soap").factory("SoapValidationReportDownloader",["$http","$q",function(){return{downloadAs:function(a,b){var c=document.createElement("form");c.action="api/soap/report/download/"+b,c.method="POST",c.target="_target";var d=document.createElement("textarea");d.name="xmlReport",d.value=a,c.appendChild(d),c.style.display="none",document.body.appendChild(c),c.submit()}}}]),angular.module("envelope").factory("Envelope",["$http","$q","XmlEditor","XmlCursor","ValidationResult","EnvelopeReport","Message","ValidationSettings",function(a,b,c,d,e,f,g,h){var i={testCase:null,selectedTestCase:null,editor:new c,cursor:new d,validationResult:new e,message:new g,report:new f,validationSettings:new h,setContent:function(a){i.message.content=a,i.editor.instance.doc.setValue(a),i.message.notifyChange()},getContent:function(){return i.message.content}};return i}]),angular.module("envelope").factory("EnvelopeReport",["$http","Report",function(a,b){var c=function(){b.call(this,arguments)};return c.prototype=Object.create(b.prototype),c.prototype.constructor=c,c.prototype.generateByFormat=function(a,b){return this.generate("api/envelope/report/generate/"+b,a)},c.prototype.downloadByFormat=function(a,b){return this.generate("api/envelope/report/download/"+b,a)},c}]),angular.module("envelope").factory("EnvelopeTestCaseListLoader",["$q","$http",function(a,b){return function(){var c=a.defer();return b.get("api/envelope/testcases/",{timeout:6e4}).then(function(a){c.resolve(angular.fromJson(a.data))},function(a){c.reject(a.data)}),c.promise}}]),angular.module("envelope").factory("EnvelopeValidator",["$http","$q","XmlEditorUtils",function(a,b,c){var d=function(){};return d.prototype.validate=function(d,e){var f=b.defer();if(c.isXML(d)){var g=angular.fromJson({content:d});a.post("api/envelope/testcases/"+e+"/validate",g,{timeout:6e4}).then(function(a){f.resolve(angular.fromJson(a.data))},function(a){f.reject(a.data)})}else f.reject("Message provided is not an xml message");return f.promise},d}]),angular.module("cf").factory("CF",["$rootScope","$http","$q","HL7","Editor","EDICursor","NewValidationResult","Er7Message","DataInstanceReport","Tree",function(a,b,c,d,e,f,g,h,i,j){var k={editor:new e,cursor:new f,tree:new j,validationResult:null,dqaValidationResult:null,testCase:null,selectedTestCase:null,message:new h,searchTableId:0,report:new i};return k}]),angular.module("cb").factory("CFTestCaseListLoader",["$q","$http",function(a,b){return function(){var c=a.defer();return b.get("api/cf/testcases",{timeout:6e4}).then(function(a){c.resolve(angular.fromJson(a.data))},function(a){c.reject(a.data)}),c.promise}}]),angular.module("cb").factory("CB",["$http","$q","Editor","EDICursor","ValidationResult","DataInstanceReport","Er7Message","ValidationSettings","Tree",function(a,b,c,d,e,f,g,h,i){var j={testCase:null,selectedTestCase:null,editor:new c,tree:new i,cursor:new d,validationResult:new e,message:new g,report:new f,validationSettings:new h,setContent:function(a){j.message.content=a,j.editor.instance.doc.setValue(a),j.message.notifyChange()},getContent:function(){return j.message.content}};return j}]),angular.module("cb").factory("CBTestCaseListLoader",["$q","$http",function(a,b){return function(){var c=a.defer();return b.get("api/cb/testcases",{timeout:6e4}).then(function(a){c.resolve(angular.fromJson(a.data))},function(a){c.reject(a.data)}),c.promise}}]),angular.module("connectivity").factory("Connectivity",["$rootScope","$http","$q","HL7","ConnectivityPart","Logger","Endpoint","ConnectivityUser",function(a,b,c,d,e,f,g,h){var i={testCase:null,selectedTestCase:null,logger:new f,request:new e,response:new e,serverEndpoint:new g(a.appInfo.url+"/ws/iisService"),user:new h};return i}]),angular.module("connectivity").factory("ConnectivityTestCaseListLoader",["$q","$http",function(a,b){return function(){var c=a.defer();return b.get("api/connectivity/testcases",{timeout:6e4}).then(function(a){c.resolve(angular.fromJson(a.data))},function(){c.reject("Sorry, failed to fetch the test cases. Please refresh your page.")}),c.promise}}]),angular.module("connectivity").factory("ConnectivityInitiator",["$q","$http",function(a,b){var c=function(){};return c.prototype.send=function(c,d,e){var f=a.defer(),g=angular.fromJson({testCaseId:d,content:e,endpoint:c.receiverEndpoint,u:c.receiverUsername,p:c.receiverPassword,facilityId:c.receiverFacilityId});return b.post("api/connectivity/send",g,{timeout:6e4}).then(function(a){f.resolve(angular.fromJson(a.data))},function(a){f.reject(a)}),f.promise},c}]),angular.module("connectivity").factory("ConnectivityValidator",["$q","$http","XmlEditorUtils",function(a,b,c){var d=function(){};return d.prototype.validate=function(d,e,f,g,h){var i=a.defer();if(c.isXML(d)){var j=angular.fromJson({content:d,testCaseId:e,userId:f,type:g,requestMessage:h});b.post("api/connectivity/validate",j,{timeout:6e4}).then(function(a){i.resolve(angular.fromJson(a.data))},function(a){i.reject(a.data)})}else i.reject("Message provided is not an xml message");return i.promise},d}]),angular.module("connectivity").factory("ConnectivityPart",["$rootScope","$http","$q","HL7","Editor","XmlCursor","ValidationResult","ConnectivityReport","Message","ValidationSettings",function(a,b,c,d,e,f,g,h,i,j){var k=function(){this.editor=new e,this.cursor=new f,this.validationResult=new g,this.message=new i,this.report=new h,this.validationSettings=new j};return k.prototype.setContent=function(a){this.message.content=a,this.editor.instance.doc.setValue(a),this.message.notifyChange()},k.prototype.formatContent=function(){this.editor.format()},k.prototype.getContent=function(){return this.message.content},k}]),angular.module("connectivity").factory("ConnectivityReport",["$http","Report",function(a,b){var c=function(){b.call(this,arguments)};return c.prototype=Object.create(b.prototype),c.prototype.constructor=c,c.prototype.generateByFormat=function(a,b){return this.generate("api/connectivity/report/generate/"+b,a)},c.prototype.downloadByFormat=function(a,b){return this.generate("api/connectivity/report/download/"+b,a)},c}]),angular.module("connectivity").factory("ConnectivityUser",["Endpoint","ConnectivityTransaction","$q","$http",function(a,b,c,d){var e=function(){this.id=null,this.senderUsername=null,this.senderPassword=null,this.senderFacilityID=null,this.receiverUsername=null,this.receiverPassword=null,this.receiverFacilityId=null,this.receiverEndpoint=null,this.endpoint=new a,this.transaction=new b};return e.prototype.init=function(){var a=c.defer(),b=this,e=angular.fromJson({id:b.id});return d.post("api/user/init",e).then(function(c){var d=angular.fromJson(c.data);b.id=d.id,b.senderUsername=d.username,b.senderPassword=d.password,b.senderFacilityID=d.facilityID,b.receiverUsername=null,b.receiverPassword=null,b.transaction.init(b.senderUsername,b.senderPassword,b.senderFacilityID),a.resolve(!0)},function(b){a.reject(b)}),a.promise},e}]),angular.module("connectivity").factory("ConnectivityTransaction",["$q","$http",function(a,b){var c=function(){this.username=null,this.password=null,this.facilityID=null,this.incoming=null,this.outgoing=null};return c.prototype.messages=function(){var c=a.defer(),d=this,e=angular.fromJson({username:d.username,password:d.password,facilityID:d.facilityID});return b.post("api/connectivity/transaction",e).then(function(a){var b=angular.fromJson(a.data);d.incoming=b.incoming,d.outgoing=b.outgoing,c.resolve(b)},function(){c.reject(null)}),c.promise},c.prototype.init=function(a,b,c){this.clearMessages(),this.username=a,this.password=b,this.facilityID=c},c.prototype.clearMessages=function(){this.incoming=null,this.outgoing=null},c.prototype.closeConnection=function(){var c=this,d=a.defer(),e=angular.fromJson({username:c.username,password:c.password,facilityID:c.facilityID});return b.post("api/connectivity/transaction/close",e).then(function(){c.clearMessages(),d.resolve(!0)},function(){d.reject(null)}),d.promise},c.prototype.openConnection=function(){var c=this,d=a.defer(),e=angular.fromJson({username:c.username,password:c.password,facilityID:c.facilityID});return b.post("api/connectivity/transaction/open",e).then(function(){c.clearMessages(),d.resolve(!0)},function(){d.reject(null)}),d.promise},c}]),angular.module("connectivity").factory("ConnectivityClock",["$interval","Clock",function(a,b){return new b(1e3)}]),angular.module("profile-viewer").factory("Profile",["Resource",function(a){return a("api/cf/profiles/:id",{id:"@id"})}]),angular.module("profile-viewer").factory("ProfileLoader",["$http","$q",function(a,b){return function(c){var d=b.defer();return a.get("api/cf/profiles/"+c,{timeout:6e4}).then(function(a){d.resolve(angular.fromJson(a.data))},function(a){d.reject(404===a.status?"Cannot create profile tree":"Unable to create the profile tree")}),d.promise}}]),angular.module("profile-viewer").factory("ProfileListLoader",["$http","$q",function(a,b){return function(){var c=b.defer();return a.get("api/cf/profiles",{timeout:6e4}).then(function(a){c.resolve(angular.fromJson(a.data))},function(a){c.reject(404===a.status?"Cannot create profile tree":"Unable to create the profile tree")}),c.promise}}]),angular.module("profile-viewer").factory("ProfileModelLoader",["$http","$q",function(a,b){return function(c){var d=b.defer();return a.get("api/cf/profiles/"+c+"/parse",{cache:!0,isArray:!0,timeout:6e4}).then(function(a){d.resolve(angular.fromJson(a.data))},function(a){d.reject(404===a.status?"Cannot create profile tree":"Unable to create the profile tree")}),d.promise}}]),angular.module("hl7").factory("HL7",["$rootScope","$http","$q",function(a,b,c){var d={Report:{generate:function(a,d){var e=c.defer();return b({url:a,data:$.param({xmlReport:d}),headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"POST",timeout:6e4}).success(function(a){e.resolve(angular.fromJson(a))}).error(function(a){e.reject(a)}),e.promise},download:function(a,b){var c=document.createElement("form");c.action=a,c.method="POST",c.target="_target";var d=document.createElement("textarea");d.name="xmlReport",d.value=b,c.appendChild(d),c.style.display="none",document.body.appendChild(c),c.submit()}},Message:{parse:function(a,d){var e=c.defer(),f=angular.fromJson({er7Message:d});return b.post(a,f,{timeout:6e4}).then(function(a){e.resolve(angular.fromJson(a.data))},function(a){e.reject(a.data)}),e.promise},get:function(a){var d=c.defer();return b.get(a,{timeout:6e4}).then(function(a){d.resolve(angular.fromJson(a.data))},function(a){d.reject(a.data)}),d.promise},validate:function(a,d){var e=c.defer(),f=angular.fromJson({er7Message:d});return b.post(a,f,{timeout:6e4}).then(function(a){e.resolve(angular.fromJson(a.data))},function(a){e.reject(a.data)}),e.promise},download:function(a){var b=document.createElement("form");b.action="api/hl7/message/download",b.method="POST",b.target="_target";var c=document.createElement("textarea");c.name="er7Message",c.value=a,b.appendChild(c),b.style.display="none",document.body.appendChild(b),b.submit()}},Profile:{get:function(a){var d=c.defer();return b.get(a,{timeout:6e4}).then(function(a){d.resolve(angular.fromJson(a.data))},function(a){d.reject(a.data)}),d.promise},parse:function(a){var d=c.defer();return b.get(a,{timeout:6e4}).then(function(a){d.resolve(angular.fromJson(a.data))},function(a){d.reject(a.data)}),d.promise}},MessageListLoader:{get:function(a){var d=c.defer();return b.get(a,{timeout:6e4}).then(function(a){d.resolve(angular.fromJson(a.data))},function(a){d.reject(a.data)}),d.promise}},ValidationResultItem:function(){return{data:[],updateIndicator:"0",show:!0,setData:function(a){this.data=a,this.notify()},notify:function(){this.updateIndicator=(new Date).getTime()}}},ValidationResult:function(a){return{key:a,xml:"",errors:d.ValidationResultItem(),affirmatives:d.ValidationResultItem(),ignores:d.ValidationResultItem(),alerts:d.ValidationResultItem(),warnings:d.ValidationResultItem(),saveState:function(){sessionStorage.setItem(this.key,this.content)},restoreState:function(){this.content=sessionStorage.getItem(this.key)},hasState:function(){return sessionStorage.getItem(this.key)!=={xml:""}&&null!=sessionStorage.getItem(this.key)},getState:function(){return sessionStorage.getItem(this.key)},getContent:function(){return this.content},setContent:function(a){this.content=a}}},CurrentMessage:function(a){return{key:a,updateIndicator:"0",data:{id:-1,content:"",name:""},clear:function(){this.setId(-1),this.setContent(""),this.setName(""),sessionStorage.setItem(this.key,null)},storeMessage:function(){sessionStorage.setItem(this.key,this.data.content)},getStoredMessage:function(){return sessionStorage.getItem(this.key)},getId:function(){return this.data.id},setId:function(a){this.data.id=a},getContent:function(){return this.data.content},setContent:function(a){this.data.content=a,this.storeMessage(),this.notifyChange()},setName:function(a){this.data.name=a},setData:function(a,b,c){this.data.id=a,this.setContent(b),this.Name(c)},getData:function(){return this.data},notifyChange:function(){this.updateIndicator=(new Date).getTime()}}},Editor:function(){return{updateIndicator:"0",editor:null,notifyChange:function(){this.updateIndicator=(new Date).getTime()}}},ExampleMessages:function(a){return{key:a,data:null,updateIndicator:"0",clear:function(){sessionStorage.setItem(this.key,null)},saveState:function(){sessionStorage.setItem(this.key,angular.toJson(this.data))},restoreState:function(){this.data=this.getState()},restoreContentState:function(){this.data=this.getState(),this.notifyChange()},hasState:function(){return null!=sessionStorage.getItem(this.key)},getState:function(){return angular.fromJson(sessionStorage.getItem(this.key))},setData:function(a){this.data=a,this.notifyChange(),this.saveState()},getData:function(){return this.data},notifyChange:function(){this.updateIndicator=(new Date).getTime()}}},Cursor:function(){return{line:1,startIndex:-1,endIndex:-1,index:-1,segment:"",triggerTree:void 0}},TestCase:{get:function(a){var d=c.defer();return b.get(a,{timeout:6e4}).then(function(a){d.resolve(angular.fromJson(a.data))},function(a){d.reject(a.data)}),d.promise},"new":function(a){return{key:a,id:-1,saveState:function(){sessionStorage.setItem(this.key,this.id)},restoreState:function(){this.id=sessionStorage.getItem(this.key)},hasState:function(){return null!=sessionStorage.getItem(this.key)&&""!=sessionStorage.getItem(this.key)&&-1!=parseInt(sessionStorage.getItem(this.key))},getState:function(){return sessionStorage.getItem(this.key)},getId:function(){return this.id},setId:function(a){this.id=a},get:function(a){var d=c.defer();return b.get(a,{timeout:6e4}).then(function(a){d.resolve(angular.fromJson(a.data))},function(a){d.reject(a.data)}),d.promise}}}}};return d}]),angular.module("hl7").factory("HL7NodeFinder",["$rootScope","$http","$q","HL7TreeUtils",function(){return{}}]),angular.module("hl7").factory("HL7CursorUtils",["$rootScope","$http","$q","HL7EditorUtils",function(a,b,c,d){return{getCoordinate:function(a){try{if(null!=a){var b=d.getSeparators(),c=a.doc.getCursor(!0),e=c.ch,f=a.doc.getLine(c.line),g=f.toString().split(""),h=e-1,i=e;if(0==b.length)return;for(;h>0&&-1===$.inArray(g[h],b);)h--;for(;i<g.length&&-1===$.inArray(g[i],b);)i++;return this.createCoordinate(c.line+1,h+1,i,e)}}catch(j){}},createCoordinate:function(a,b,c,d,e){try{return angular.fromJson({line:a,startIndex:b,endIndex:c,index:d,triggerTree:e})}catch(f){}},getStartIndex:function(a,b){if(a>=0){for(var c=0,d=0,e=null;a>=c;)e=b[c],""===e?d+=1:d=d+e.length+1,c++;return d}return 0}}}]),angular.module("hl7").factory("HL7EditorUtils",["$rootScope","$http","$q",function(){return{getSeparators:function(){return["|","^","&","~"]},getSeparatorsMap:function(){var a=this.getSeparators(),b=new Array(4);return b.field_separator=a[0],b.component_separator=a[1],b.subcomponent_separator=a[2],b.continuation_separator=a[3],b},select:function(a,b){var c=b.startIndex,d=b.endIndex,e=b.line;if(null!==c&&null!==d&&c>=0&&d>=0){var e=parseInt(e)-1;a.doc.setSelection({line:e,ch:c},{line:e,ch:d}),a.scrollIntoView({line:e,ch:c},{line:e,ch:d})}},isHL7:function(a){return a.startsWith("MSH")}}}]),angular.module("hl7").factory("HL7Utils",function(){return{getPosition:function(a,b){try{switch(b){case"SEGMENT":return 1;case"FIELD":return a.split("-")[1].split(".")[0];case"COMPONENT":return a.split(".")[1];case"SUB_COMPONENT":return a.split(".")[2]}}catch(c){return 0}},getInstanceNumber:function(a,b){try{switch(b){case"SEGMENT":return a.split("[")[1].split("]")[0];case"FIELD":return a.split("-")[1].split("[")[1].split("]")[0];case"COMPONENT":return a.split("-")[2].split("[")[1].split("]")[0];case"SUB_COMPONENT":return a.split("-")[3].split("[")[1].split("]")[0]}}catch(c){return 1}},getType:function(a){if(!(a.indexOf("-")>0))return"SEGMENT";if(1===a.split(".").length)return"FIELD";if(2===a.split(".").length)return"COMPONENT";if(3===a.split(".").length)return"SUB_COMPONENT";throw new Error("Invalid Path "+a)},prettyPath:function(a){return a.replace(/\[[^\]]*?\]/g,"")}}}),angular.module("hl7").factory("HL7TreeUtils",["$rootScope","$http","$q","HL7CursorUtils","HL7Utils",function(a,b,c,d,e){return{findByIndex:function(a,b,c){var d=this.findNodeByLineNumber(a,b.line);return void 0==d||null==d?null:this.findNodeByIndex(a,d,b.line,b.startIndex+1,b.endIndex+1,c)},findByPath:function(a,b,c){var d=this.findNodeByLineNumber(a,b);return void 0==d||null==d?null:this.findNodeByPath(a,d,b,c)},findNodeByPath:function(a,b,c,d){if(d.startsWith(b.data.path)){if(angular.equals(b.data.path,d))return this.findLastChild(a,b);var e=a.get_children(b);if(e&&e.length>0)for(var f=0;f<e.length;f++){var g=this.findNodeByPath(a,e[f],c,d);if(null!=g)return g}}return null},findLastChild:function(a,b){var c=a.get_children(b);if(!(c&&c.length>0))return b;for(var d=0;d<c.length;d++)return this.findLastChild(a,c[d])},findNodeByIndex:function(a,b,c,d,e,f){if(b.data.lineNumber<=c){var g=this.getEndIndex(b,f);if(angular.equals(b.data.startIndex,d)&&angular.equals(g,e))return this.findLastChild(a,b);var h=a.get_children(b);if(h&&h.length>0)for(var i=0;i<h.length;i++){var j=this.findNodeByIndex(a,h[i],c,d,e,f);if(null!=j)return j}}return null},findNodeByLineNumber:function(a,b){if(void 0!=a){var c=a.get_first_branch(),d=a.get_siblings(c);if(d){if(1===b)return c;if(b<=d.length)return d[b-1]}}return null},selectNodeByIndex:function(a,b,c){var d=this.findByIndex(a,b,c);if(null!==d){var e=a.get_selected_branch();e!==d&&(a.collapse_all(),a.select_branch(d),a.expand_branch(d))}},selectNodeByPath:function(a,b,c){var d=this.findByPath(a,b,c);if(null!==d){var e=a.get_selected_branch();e!==d&&(a.collapse_all(),a.select_branch(d),a.expand_branch(d))}},getStringValue:function(a,b,c){var d=e.getPosition(b,a),f=e.getInstanceNumber(b,a);switch(a){case"SEGMENT":return c.replace("\r","");case"FIELD":if(c.startsWith("MSH")&&1==d)return"";var g=c.startsWith("MSH")?d-2:d-1,h=c.substring(4).split("|");return(f>1?h[g].split("~")[f-1]:h[g]).replace("\r","");case"COMPONENT":var h=this.getStringValue("FIELD",b,c);return(f>1?h.split("^")[d-1].split("~")[f-1]:h.split("^")[d-1]).replace("\r","");case"SUB_COMPONENT":var h=this.getStringValue("COMPONENT",b,c),i=h.split("&");return(f>1?i[d-1].split("~")[f-1]:i[d-1]).replace("\r","")}},getEndIndex:function(a,b){try{var c=a.data;return void 0!=c.endIndex&&-1!=c.endIndex?c.endIndex:this.getEndColumn(c.lineNumber,c.startIndex,c.type,c.path,b)}catch(d){return-1}},getEndColumn:function(a,b,c,d,e){try{var f=e.toString().split(1==e.toString().split("\n").length?"\r":"\n");return a-1<f.length?null==f[a-1]||angular.equals("",f[a-1].toString().trim())?-1:b+this.getStringValue(c,d,f[a-1]).length:-1}catch(g){return-1}}}}]),angular.module("commonServices").factory("TestCase",["$http","TestContext","$q",function(){var a=function(){this.id=null,this.sutType=null,this.label="",this.parentName="",this.testStory={},this.updateIndicator="0",this.testPackagePath=null,this.testProcedurePath=null,this.instructionsText=null,this.instructionsImage=null,this.messageContentImage=null,this.testDataSpecificationImage=null,this.testDataSpecificationImage2=null};return a.prototype.init=function(a){a&&(this.id=a.id,this.sutType=a.sutType,this.testType=a.testType,this.label=a.label,this.parentName=void 0!=a.testPlan?a.testPlan.label:a.parentName,this.testStory=a.testStory,this.testPackagePath=a.testPackagePath,this.testProcedurePath=a.testProcedurePath,this.instructionsText=a.instructionsText,this.instructionsImage=a.instructionsImage,this.messageContentImage=a.messageContentImage,this.testDataSpecificationImage=a.testDataSpecificationImage,this.testDataSpecificationImage2=a.testDataSpecificationImage2,this.type=a.type,this.notifyChange())},a.prototype.clear=function(){this.id=null,this.sutType=null,this.testType=null,this.label=null,this.parentName=null,this.testStory={},this.testPackagePath=null,this.testProcedurePath=null,this.instructionsText=null,this.instructionsImage=null,this.messageContentImage=null,this.testDataSpecificationImage=null,this.testDataSpecificationImage2=null,this.type=null,this.notifyChange()},a.prototype.notifyChange=function(){this.updateIndicator=(new Date).getTime()},a.prototype.downloadTestPackage=function(){if(null!=this.id){var a=this,b=document.createElement("form");b.action="api/testCases/"+a.id+"/testPackage",b.method="POST",b.target="_target",b.style.display="none",document.body.appendChild(b),b.submit()}},a.prototype.downloadTestProcedure=function(){if(null!=this.id){var a=this,b=document.createElement("form");b.action="api/testPlans/"+a.id+"/testProcedure",b.method="POST",b.target="_target",b.style.display="none",document.body.appendChild(b),b.submit()}},a}]),angular.module("commonServices").factory("TestStep",["$http","$q",function(){var a=function(){this.id=null,this.label="",this.parentName="",this.testStory={},this.description=null,this.dataSheetHtmlPath=null,this.dataSheetPdfPath=null};return a.prototype.init=function(a){a&&(this.id=a.id,this.label=a.label,this.type=a.type,this.parentName=a.parentName,this.testStory=a.testStory,this.description=a.description,this.dataSheetHtmlPath=a.dataSheetHtmlPath,this.dataSheetPdfPath=a.dataSheetPdfPath)},a}]),angular.module("commonServices").factory("TestContext",["$http","$q",function(){var a=function(){this.id=null};return a.prototype.init=function(a){this.id=a.id},a.prototype.clear=function(){this.id=null},a}]),angular.module("commonServices").factory("Editor",["$http","$q",function(){var a=function(){this.instance=null,this.updateIndicator="0",this.id=null,this.name=""};return a.prototype.notifyChange=function(){this.updateIndicator=(new Date).getTime()},a.prototype.init=function(a){void 0!=a&&(this.instance=a)},a.prototype.getContent=function(){return void 0!=this.instance?this.instance.doc.getValue():null},a.prototype.setContent=function(a){void 0!=this.instance&&(this.instance.doc.setValue(a),this.notifyChange())},a}]),angular.module("commonServices").factory("XmlEditor",["Editor",function(a){var b=function(){a.apply(this,arguments)};return b.prototype=Object.create(a.prototype),b.prototype.constructor=b,b.prototype.format=function(){this.instance.doc.setValue(this.instance.doc.getValue().replace(/\n/g,"").replace(/[\t ]+\</g,"<").replace(/\>[\t ]+\</g,"><").replace(/\>[\t ]+$/g,">"));var a=this.instance.lineCount(),b=this.instance.getTextArea().value.length;this.instance.autoFormatRange({line:0,ch:0},{line:a,ch:b})},b}]),angular.module("commonServices").factory("EDICursor",function(){var a=function(){this.line=1,this.startIndex=-1,this.endIndex=-1,this.index=-1,this.segment="",this.updateIndicator="0",this.triggerTree=void 0};return a.prototype.init=function(a,b,c,d,e){this.line=a,this.startIndex=b,this.endIndex=c,this.index=d,this.triggerTree=e,this.notify()},a.prototype.notify=function(){this.updateIndicator=(new Date).getTime()},a}),angular.module("commonServices").factory("XmlCursor",function(){var a=function(){this.line=-1,this.start={line:1,index:-1},this.end={line:1,index:-1},this.updateIndicator="0"};return a.prototype.setLine=function(a){this.line=a,this.notify()},a.prototype.toString=function(){return this.line+","+this.start+","+this.end},a.prototype.notify=function(){this.updateIndicator=(new Date).getTime()},a}),angular.module("commonServices").factory("ValidationResultItem",function(){var a=function(){this.data=[],this.categories=[],this.categories.push({title:"All",data:[]}),this.show=!0,this.updateIndicator="0"};return a.prototype.init=function(a){this.data=a,this.categories=[],this.categories.push({title:"All",data:[]}),this.show=!0,this.notify()
},a.prototype.notify=function(){this.updateIndicator=(new Date).getTime()},a}),angular.module("commonServices").factory("ValidationSettings",function(){var a=function(){this.errors=!0,this.affirmatives=!0,this.ignores=!0,this.alerts=!0,this.warnings=!0};return a}),angular.module("commonServices").factory("ValidationResult",["ValidationResultItem","$q",function(a){var b=function(b){this.key=b,this.xml="",this.errors=new a,this.affirmatives=new a,this.ignores=new a,this.alerts=new a,this.warnings=new a,this.informationals=new a,this.id=""};return b.prototype.updateId=function(){this.id=(new Date).getTime()},b.prototype.clear=function(){this.xml="",this.errors=new a,this.affirmatives=new a,this.ignores=new a,this.alerts=new a,this.warnings=new a,this.informationals=new a,this.updateId()},b.prototype.init=function(a){this.xml=a.xml,this.errors.init(a.errors),this.affirmatives.init(a.affirmatives),this.ignores.init(a.ignores),this.alerts.init(a.alerts),this.warnings.init(a.warnings),this.informationals.init(a.informationals),this.updateId()},b.prototype.saveState=function(){sessionStorage.setItem(this.key,this.content)},b.prototype.restoreState=function(){this.content=sessionStorage.getItem(this.key)},b.prototype.hasState=function(){return sessionStorage.getItem(this.key)!=={xml:""}&&null!=sessionStorage.getItem(this.key)},b.prototype.getState=function(){return sessionStorage.getItem(this.key)},b.prototype.getContent=function(){return this.content},b.prototype.setContent=function(a){this.content=a},b}]),angular.module("commonServices").factory("NewValidationResult",["ValidationResult","HL7Utils",function(a){var b=function(){a.apply(this,arguments),this.json=null},c=function(){this.description=null,this.path=null,this.line=null,this.column=null,this.value=null,this.details=null,this.instance=null,this.id=(new Date).getTime(),this.failureType=null};return c.prototype.initLocation=function(a){a&&(this.desc=a.desc,this.path=a.path,this.line=a.line,this.column=a.column)},b.prototype=Object.create(a.prototype),b.prototype.constructor=b,b.prototype.addResult=function(a,b){var c=this.getCategory(a,"All");c.data.push(b);var d=this.getCategory(a,b.category);d.data.push(b)},b.prototype.getCategory=function(a,b){if(b){for(var c=null,d=0;d<a.categories.length;d++)a.categories[d].title===b&&(c=a.categories[d]);return null===c&&(c={title:b,data:[]},a.categories.push(c)),c}return null},b.prototype.addItem=function(a){try{"Error"===a.classification?this.addResult(this.errors,a):"Informational"===a.classification||"Info"===a.classification?this.addResult(this.informationals,a):"Warning"===a.classification?this.addResult(this.warnings,a):"Alert"===a.classification?this.addResult(this.alerts,a):"Affirmative"===a.classification?this.addResult(this.affirmatives,a):"DQA"===a.classification&&this.addResult(this.dqas,a)}catch(b){console.log(b)}},b.prototype.init=function(b){if(a.prototype.clear.call(this),this.json=b,b.Report)for(var c=0;c<b.Report.length;c++){var d=b.Report[c];this.addItem(d.Entry)}},b}]),angular.module("commonServices").factory("DQAValidationResult",function(){var a=function(a){this.errors=[],this.warnings=[];for(var b=0;b<a.issuesList.length;b++){var c=a.issuesList[b];"Error"===c.type?this.errors.push(c):this.warnings.push(c)}};return a}),angular.module("commonServices").factory("Profile",["$http","$q",function(){var a=function(){this.id=null,this.xml="",this.json="",this.name=[],this.description=""};return a.prototype.notifyChange=function(){this.updateIndicator=(new Date).getTime()},a.prototype.init=function(a){this.id=a.id,this.xml=a.xml,this.json=null,this.name=a.name,this.description=a.description},a.prototype.clear=function(){this.id=null,this.xml=null,this.json=null,this.name=null,this.description=null},a}]),angular.module("commonServices").factory("Message",["$http","$q",function(){var a=function(){this.id=null,this.name="",this.content="",this.description="",this.updateIndicator="0"};return a.prototype.notifyChange=function(){this.updateIndicator=(new Date).getTime()},a.prototype.setContent=function(a){this.content=void 0!=a?a:"",this.notifyChange()},a.prototype.init=function(a){this.id=a.id,this.name=a.name,this.description=a.description,this.setContent(a.content)},a.prototype.download=function(){var a=document.createElement("form");a.action="api/messages/downloadContent",a.method="POST",a.target="_target";var b=document.createElement("textarea");b.name="content",b.value=this.content,a.appendChild(b),a.style.display="none",document.body.appendChild(a),a.submit()},a}]),angular.module("commonServices").factory("Tree",function(){var a=function(){this.id=null,this.root={}};return a}),angular.module("commonServices").factory("Er7Message",["$http","$q","Message",function(a,b,c){var d=function(){c.apply(this,arguments)};return d.prototype=Object.create(c.prototype),d.prototype.constructor=d,d}]),angular.module("commonServices").factory("Report",["$http","$q",function(a,b){var c=function(){this.html=null};return c.prototype.generate=function(c,d){var e=b.defer();return a({url:c,data:$.param({xmlReport:d}),headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"POST",timeout:6e4}).success(function(a){e.resolve(angular.fromJson(a))}).error(function(a){e.reject(a)}),e.promise},c.prototype.download=function(a,b){var c=document.createElement("form");c.action=a,c.method="POST",c.target="_target";var d=document.createElement("textarea");d.name="xmlReport",d.value=b,c.appendChild(d),c.style.display="none",document.body.appendChild(c),c.submit()},c}]),angular.module("commonServices").factory("DataInstanceReport",["$http","NewValidationReport",function(a,b){var c=function(){b.call(this,arguments)};return c.prototype=Object.create(b.prototype),c.prototype.constructor=c,c.prototype.generateByFormat=function(a,b){return this.generate("api/datainstance/report/generate/"+b,a)},c.prototype.downloadByFormat=function(a,b){return this.generate("api/datainstance/report/download/"+b,a)},c}]),angular.module("commonServices").factory("Er7MessageValidator",["$http","$q","HL7EditorUtils",function(a,b,c){var d=function(){};return d.prototype.validate=function(d,e,f){var g=b.defer();if(c.isHL7(e)){var h=angular.fromJson({testCaseId:d,er7Message:e,name:f});a.post("api/datainstance/message/validate",h,{timeout:6e4}).then(function(a){try{g.resolve(angular.fromJson(a.data))}catch(b){g.reject("Invalid character in received response")}},function(a){g.reject(a.data)})}else g.reject("Message provided is not an HL7 v2 message");return g.promise},d}]),angular.module("commonServices").factory("Er7MessageParser",["$http","$q","HL7EditorUtils",function(a,b,c){var d=function(){};return d.prototype.parse=function(d,e,f){var g=b.defer();if(c.isHL7(e)){var h=angular.fromJson({testCaseId:d,er7Message:e,name:f});a.post("api/datainstance/message/parse",h,{timeout:6e4}).then(function(a){g.resolve(angular.fromJson(a.data))},function(a){g.reject(a.data)})}else g.reject("Message provided is not an HL7 v2 message");return g.promise},d}]),angular.module("commonServices").factory("DQAMessageValidator",["$http","$q",function(a,b){var c=function(){};return c.prototype.validate=function(c,d){var e=b.defer(),f=angular.fromJson({er7Message:c,facilityId:d});return a.post("api/datainstance/message/dqaValidate",f,{timeout:6e4}).then(function(a){try{e.resolve(angular.fromJson(a.data))}catch(b){e.reject("Invalid character in received response")}},function(a){e.reject(a.data)}),e.promise},c}]),angular.module("commonServices").factory("VocabularyService",["$http","$q",function(){var a=function(){};return a.prototype.searchTableValues=function(a,b,c){var d=[];return null!=a&&("TableId"===b?angular.forEach(c,function(b){angular.forEach(b.children,function(b){angular.forEach(b.tableSet.tableDefinitions,function(b){b.tdId&&-1!==b.tdId.indexOf(a)&&d.push(b)})})}):"Value"===b?angular.forEach(c,function(b){angular.forEach(b.children,function(b){angular.forEach(b.tableSet.tableDefinitions,function(b){angular.forEach(b.tableElements,function(c){c.code&&-1!==c.code.indexOf(a)&&(c.codesys=null==c.codesys?b.codesys:c.codesys,d.push(c))})})})}):"Description"===b?angular.forEach(c,function(b){angular.forEach(b.children,function(b){angular.forEach(b.tableSet.tableDefinitions,function(b){angular.forEach(b.tableElements,function(c){c.displayName&&-1!==c.displayName.indexOf(a)&&(c.codesys=null==c.codesys?b.codesys:c.codesys,d.push(c))})})})}):"ValueSetCode"===b?angular.forEach(c,function(b){angular.forEach(b.children,function(b){angular.forEach(b.tableSet.tableDefinitions,function(b){b.codesys&&-1!==b.codesys.indexOf(a)&&d.push(b)})})}):"ValueSetName"===b&&angular.forEach(c,function(b){angular.forEach(b.children,function(b){angular.forEach(b.tableSet.tableDefinitions,function(b){b.name&&-1!==b.name.indexOf(a)&&d.push(b)})})})),d},a.prototype.searchTablesById=function(a,b){var c=[];return angular.forEach(b,function(b){angular.forEach(b.children,function(b){angular.forEach(b.tableSet.tableDefinitions,function(b){b.tdId&&-1!==b.tdId.indexOf(a)&&c.push(b)})})}),c},a}]),angular.module("commonServices").factory("NewValidationReport",["$http","$q",function(a,b){var c=function(){this.content={metaData:{},result:{}}};return c.prototype.download=function(a){var b=document.createElement("form");b.action=a,b.method="POST",b.target="_target";var c=document.createElement("textarea");c.name="jsonReport",c.value=this.content,b.appendChild(c),b.style.display="none",document.body.appendChild(b),b.submit()},c.prototype.generate=function(c){var d=b.defer();return a({url:c,data:$.param({jsonReport:this.content}),headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},method:"POST",timeout:6e4}).success(function(a){d.resolve(angular.fromJson(a))}).error(function(a){d.reject(a)}),d.promise},c}]),angular.module("commonServices").factory("ValidationResultHighlighter",["$http","$q","HL7TreeUtils",function(a,b,c){var d=function(a,b,c,d,e){this.failuresConfig=a,this.histMarksMap={},this.message=b,this.report=c,this.tree=d,this.editor=e};return d.prototype.getHistMarksMap=function(){return this.histMarksMap},d.prototype.hideFailures=function(a){if(a&&a.length>0){for(var b=0;b<a.length;b++)a[b].clear();a.length=0}},d.prototype.hideAllFailures=function(){this.hideFailures(this.histMarksMap.errors),this.hideFailures(this.histMarksMap.warnings),this.hideFailures(this.histMarksMap.affirmatives),this.hideFailures(this.histMarksMap.informationals),this.hideFailures(this.histMarksMap.alerts)},d.prototype.showFailures=function(a,b){if("INPUT"===angular.element(b.currentTarget).prop("tagName")&&b.stopPropagation(),this.report&&this.tree.root){var d=this.report.result[a].categories[0].data,e=this.failuresConfig[a].className,f=(this.failuresConfig[a].checked,this.histMarksMap[a]),g=this.tree.root,h=this.editor,i=this.message.content,j=this.histMarksMap;f&&0!==f.length?this.hideFailures(this.histMarksMap[a]):angular.forEach(d,function(b){var d=c.findByPath(g,b.line,b.path);if(null!=d&&d.data&&null!=d.data){var f=c.getEndIndex(d,i)-1,k=d.data.startIndex-1,l=parseInt(b.line)-1,m=h.instance.doc.markText({line:l,ch:k},{line:l,ch:f},{atomic:!0,className:e,clearWhenEmpty:!0,clearOnEnter:!0,title:b.description});j[a]||(j[a]=[]),j[a].push(m)}})}},d}]),angular.module("commonServices").factory("Logger",function(){var a=function(){this.content=""};return a.prototype.log=function(a){this.content=this.content+"\n"+this.getCurrentTime()+":"+a},a.prototype.clear=function(){this.content=""},a.prototype.init=function(){this.clear()},a.prototype.getCurrentTime=function(){var a=new Date;return(a.getMonth()+1<10?"0":"")+(a.getMonth()+1)+"/"+(a.getDate()<10?"0":"")+a.getDate()+"/"+a.getFullYear()+" - "+(a.getHours()<10?"0":"")+a.getHours()+":"+(a.getMinutes()<10?"0":"")+a.getMinutes()+":"+(a.getSeconds()<10?"0":"")+a.getSeconds()},a}),angular.module("commonServices").factory("Endpoint",function(){var a=function(){this.value=null},a=function(a){this.value=a};return a}),angular.module("commonServices").factory("SecurityFaultCredentials",["$q","$http",function(){var a=function(){this.username=null,this.password=null};return a.prototype.init=function(a,b){this.username=a,this.password=b},a}]),angular.module("commonServices").factory("Clock",["$interval",function(a){var b=function(a){this.value=void 0,this.intervl=a};return b.prototype.start=function(b){angular.isDefined(this.value)&&this.stop(),this.value=a(b,this.intervl)},b.prototype.stop=function(){angular.isDefined(this.value)&&(a.cancel(this.value),this.value=void 0)},b}]),angular.module("tool").controller("MainCtrl",["$scope","$rootScope",function(){}]),angular.module("tool").controller("TestingCtrl",["$scope","$q","$rootScope","TestingSettings",function(a,b,c,d){a.loading=!1,a.init=function(){d.restore(),c.selectTestingType(d.getActiveTab())}}]),angular.module("tool").controller("ValidationResultDetailsCtrl",["$scope","$modalInstance","selectedElement",function(a,b,c){a.selectedElement=c,a.ok=function(){b.close(a.selectedElement)},a.cancel=function(){b.dismiss("cancel")}}]),angular.module("cf").controller("CFTestingCtrl",["$scope","$http","CF","$window","$modal","$filter","$rootScope","ngTreetableParams","CFTestCaseListLoader",function(a,b,c,d,e,f,g,h,i){a.cf=c,a.loading=!1,a.error=null,a.testCases=[],a.testCase=c.testCase,a.tabs=new Array,a.error=null,a.setActiveTab=function(b){a.tabs[0]=!1,a.tabs[1]=!1,a.tabs[2]=!1,a.tabs[3]=!1,a.activeTab=b,a.tabs[a.activeTab]=!0,0==a.activeTab&&a.$broadcast("cf:refreshEditor")},a.getTestCaseDisplayName=function(a){return a.parentName+" - "+a.label},a.loadTestCase=function(b){c.testCase=b,a.testCase=c.testCase,g.$broadcast("cf:testCaseLoaded")},a.init=function(){a.error=null,a.loading=!0,a.testCases=[],a.params=new h({getNodes:function(b){return b&&null!=b?b.children:a.testCases},getTemplate:function(){return"CFTestCase.html"}});var b=new i;b.then(function(b){a.testCases=f("orderBy")(b,"position"),a.testCases.length>0&&a.loadTestCase(a.testCases[0]),a.loading=!1,a.error=null,a.params.refresh()},function(){a.error="Sorry,cannot load the profiles",a.loading=!1})},a.openProfileInfo=function(){e.open({templateUrl:"CFProfileInfoCtrl.html",windowClass:"app-modal-window",controller:"CFProfileInfoCtrl"})}}]),angular.module("cf").controller("CFProfileInfoCtrl",["$scope","$modalInstance",function(a,b){a.close=function(){b.dismiss("cancel")}}]),angular.module("cf").controller("CFProfileViewerCtrl",["$scope","ngTreetableParams","CF","$rootScope",function(a,b,c,d){a.cf=c,a.elements=[],a.nodeData=[],a.loading=!1,a.error=null,a.profile=null,a.relevance=!0,a.trim=!0,a.getConstraintsAsString=function(a){var b="";for(var c in a)b=b+'<p style="text-align: left">'+a[c].id+" - "+a[c].description+"</p>";return b},a.showRefSegment=function(b){if(a.elements.length>0&&b)for(var c=1;c<a.elements.length;c++){var d=a.elements[c];d.id==b&&a.getNodeContent(d)}},a.show=function(b){return!a.relevance||a.relevance&&b.relevent},a.viewTable=function(b){a.cf.searchTableId=b},a.init=function(){d.$on("cf:testCaseLoaded",function(){if(null!=a.cf.testCase.testContext&&null!=a.cf.testCase.testContext.profile.json&&""!=a.cf.testCase.testContext.profile.json){a.loading=!0,a.nodeData=[],a.loading=!1,a.profile=a.cf.testCase.testContext.profile,a.elements=angular.fromJson(a.profile.json).elements;var b=null,c=!0;angular.forEach(a.elements,function(a){c&&"Datatypes"===a.name&&(b=a,c=!1)}),null!=b&&a.processDatatypes(b),a.nodeData=a.elements[0],a.params.refresh(),a.loading=!1}else a.loading=!1,a.nodeData=[],a.elements=[],a.params.refresh()}),a.params=new b({getNodes:function(b){return b?b.children:a.nodeData.children},getTemplate:function(){return"TreeNode.html"}})},a.getNodeContent=function(b){a.nodeData=b,a.params.refresh()},a.processDatatypes=function(b){angular.forEach(b.children,function(b){b.children.length>0&&angular.forEach(b.children,function(b){b.type="COMPONENT",b.icon="component.png",b.children.length>0&&angular.forEach(b.children,function(b){a.processSubComponent(b)})})})},a.processSubComponent=function(b){b.type="SUBCOMPONENT",b.icon="subcomponent.png",b.children.length>0&&angular.forEach(b.children,function(b){a.processSubComponent(b)})}}]),angular.module("cf").controller("CFValidatorCtrl",["$scope","$http","CF","$window","HL7EditorUtils","HL7CursorUtils","$timeout","HL7TreeUtils","$modal","NewValidationResult","HL7Utils","DQAValidationResult","$rootScope","Er7MessageValidator","Er7MessageParser","DQAMessageValidator","ValidationResultHighlighter",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){a.cf=c,a.testCase=c.testCase,a.message=c.message,a.selectedMessage={},a.validationResult=null,a.loading=!0,a.error=null,a.vError=null,a.vLoading=!0,a.mError=null,a.mLoading=!0,a.counter=0,a.type="cf",a.loadRate=4e3,a.tokenPromise=null,a.editorInit=!1,a.nodelay=!1,a.resized=!1,a.selectedItem=null,a.validationTabs=new Array,a.activeTab=0,a.validationConfig={dqa:{checked:!1}},a.histMarks={},a.failuresConfig={errors:{className:"failure failure-errors",checked:!1},alerts:{className:"failure failure-alerts",checked:!1},warnings:{className:"failure failure-warnings",checked:!1},informationals:{className:"failure failure-infos",checked:!1},affirmatives:{className:"failure failure-affirmatives",checked:!1}},a.validResultHighlither=new q(a.failuresConfig,a.cf.message,a.cf.report,a.cf.tree,a.cf.editor),a.messageObject=[],a.tError=null,a.tLoading=!1,a.hasContent=function(){return""!=a.cf.message.content&&null!=a.cf.message.content},a.refreshEditor=function(){g(function(){a.editor.refresh()},1e3)},a.options={paramName:"file",formAcceptCharset:"utf-8",autoUpload:!0,type:"POST"},a.$on("fileuploadadd",function(b,c){(c.autoUpload||c.autoUpload!==!1&&$(this).fileupload("option","autoUpload"))&&c.process().done(function(){var b=c.files[0].name;c.url="api/hl7/message/upload";c.submit().success(function(c){a.nodelay=!0;var d=angular.fromJson(c);a.cf.message.name=b,a.cf.editor.instance.doc.setValue(d.content),a.mError=null,a.execute()}).error(function(c,d,e){a.cf.message.name=b,a.mError="Sorry, Cannot upload file: "+b+", Error: "+e}).complete(function(){})})}),a.loadMessage=function(){null!=a.cf.testCase.testContext.message&&(a.nodelay=!0,a.selectedMessage=a.cf.testCase.testContext.message,null!=a.selectedMessage?a.editor.doc.setValue(a.selectedMessage.messageContent):(a.editor.doc.setValue(""),a.cf.message.id=null,a.cf.message.name=""),a.execute())},a.setLoadRate=function(b){a.loadRate=b},a.initCodemirror=function(){a.editor=CodeMirror.fromTextArea(document.getElementById("cfTextArea"),{lineNumbers:!0,fixedGutter:!0,theme:"elegant",mode:"edi",readOnly:!1,showCursorWhenSelecting:!0}),a.editor.setSize(null,300),a.editor.on("keyup",function(){g(function(){var b=a.editor.doc.getValue();a.error=null,a.tokenPromise&&(g.cancel(a.tokenPromise),a.tokenPromise=void 0),c.message.name=null,""!==b.trim()?a.tokenPromise=g(function(){a.execute()},a.loadRate):a.execute()})}),a.editor.on("dblclick",function(){g(function(){var b=f.getCoordinate(a.editor);a.cf.cursor.init(b.line,b.startIndex,b.endIndex,b.index,!0),h.selectNodeByIndex(a.cf.tree.root,c.cursor,c.message.content)})}),a.cf.editor.instance=a.editor,a.refreshEditor()},a.validateMessage=function(){if(a.validationTabs[0]=!0,a.failuresConfig.errors.checked=!1,a.failuresConfig.warnings.checked=!1,a.failuresConfig.alerts.checked=!1,a.failuresConfig.informationals.checked=!1,a.failuresConfig.affirmatives.checked=!1,a.hideAllFailures(),a.vLoading=!0,a.vError=null,a.dqaError=null,a.cf.dqaValidationResult=null,null!=a.cf.testCase&&""!==a.cf.message.content)try{var b=a.cf.testCase.testContext.id,c=a.cf.message.content,d=a.cf.testCase.label,e=(new n).validate(b,c,d);if(e.then(function(b){a.vLoading=!1,a.setValidationResult(b)},function(b){a.vLoading=!1,a.vError=b,a.setValidationResult(null)}),a.validationConfig.dqa.checked){a.dqaLoading=!0;var f=new p(a.cf.message.content,"1223");f.then(function(b){a.dqaLoading=!1,a.cf.dqaValidationResult=new l(b),a.dqaValidationResult=a.cf.dqaValidationResult},function(b){a.dqaLoading=!1,a.dqaError=b,a.cf.dqaValidationResult=null})}}catch(g){a.vLoading=!1,a.vError=g,a.setValidationResult(null)}else a.setValidationResult(null),a.vLoading=!1,a.vError=null},a.setValidationResult=function(b){null!==b?(a.cf.validationResult=new j,a.cf.validationResult.init(b),a.validationResult=a.cf.validationResult,a.cf.report.result=a.validationResult,angular.equals(b,{})?(a.cf.report.result=null,a.cf.report.metaData=null):a.cf.report.metaData={reportHeader:{title:"Message Validation Report",date:(new Date).getTime()},validationTypeHeader:{title:"Validation Type",type:"Context-free"},toolHeader:{title:"Testing Tool",name:"NIST-CDC Immunization Test Suite - HL7 V2.5.1 Validation Tool",versionRelease:"1.0"},profileHeader:{name:"",organization:"NIST",type:"",profileVersion:"",profileDate:"",standard:"HL7 Version 2.5.1 Implementation Guide For Immunization Messaging Rel .1.5 (10/01/2014) Immunization Clarification Addendum (Date)"},messageHeader:{encoding:"ER7"},summaryHeader:{errorCount:a.cf.report.result.errors.categories[0].data.length,warningCount:a.cf.report.result.warnings.categories[0].data.length,informationalCount:a.cf.report.result.informationals.categories[0].data.length,alertCount:a.cf.report.result.alerts.categories[0].data.length,affirmativeCount:a.cf.report.result.affirmatives.categories[0].data.length}}):(a.cf.validationResult=null,a.validationResult=null,a.cf.report.result=null)},a.select=function(b){if(void 0!=b&&null!=b.path&&-1!=b.line){var c=h.selectNodeByPath(a.cf.tree.root,b.line,b.path),d=null!=c?c.data:null;a.cf.cursor.init(null!=d?d.lineNumber:b.line,null!=d?d.startIndex-1:b.column-1,null!=d?d.endIndex-1:b.column-1,null!=d?d.startIndex-1:b.column-1,!1),e.select(a.editor,a.cf.cursor)}},a.showDetails=function(b){var c=i.open({templateUrl:"ValidationResultDetailsCtrl.html",controller:"ValidationResultDetailsCtrl",resolve:{selectedElement:function(){return b}}});c.result.then(function(b){a.selectedElement=b},function(){})},a.showDQADetails=function(b){var c=i.open({templateUrl:"DQAValidationResultDetailsCtrl.html",controller:"DQAValidationResultDetailsCtrl",resolve:{selectedElement:function(){return b}}});c.result.then(function(b){a.selectedElement=b},function(){})},a.clearMessage=function(){a.nodelay=!0,a.mError=null,a.editor&&(a.editor.doc.setValue(""),a.execute())},a.saveMessage=function(){a.cf.message.download()},a.parseMessage=function(){if(a.tLoading=!0,null!=a.cf.testCase.testContext.profile&&""!=a.cf.message.content){var b=(new o).parse(a.cf.testCase.testContext.id,a.cf.message.content,a.cf.testCase.label);b.then(function(b){a.tLoading=!1,a.messageObject=b},function(b){a.tLoading=!1,a.tError=b})}else a.messageObject=[],a.tError=null,a.tLoading=!1},a.onNodeSelect=function(b){var c=h.getEndIndex(b,a.cf.message.content);a.cf.cursor.init(b.data.lineNumber,b.data.startIndex-1,c-1,b.data.startIndex-1,!1),e.select(a.editor,a.cf.cursor)},a.execute=function(){a.error=null,a.tError=null,a.mError=null,a.vError=null,a.cf.message.content=a.editor.doc.getValue(),a.validateMessage(),a.parseMessage()},a.showFailures=function(b,c){a.validResultHighlither.showFailures(b,c)},a.hideAllFailures=function(){a.validResultHighlither.hideAllFailures()},a.isVFailureChecked=function(b){return a.failuresConfig[b].checked},a.init=function(){a.vLoading=!1,a.tLoading=!1,a.mLoading=!1,a.error=null,a.tError=null,a.mError=null,a.vError=null,a.initCodemirror(),a.setValidationResult({}),a.$on("cf:refreshEditor",function(b){a.refreshEditor(),b.preventDefault()}),m.$on("cf:testCaseLoaded",function(){a.refreshEditor(),null!=a.cf.testCase&&null!=a.cf.testCase.id&&a.clearMessage()})}}]),angular.module("cf").controller("CFReportCtrl",["$scope","$sce","$http","CF",function(a,b,c,d){a.cf=d,a.error=null,a.loading=!1,a.init=function(){},a.downloadAs=function(b){a.cf.report.downloadByFormat(a.cf.report,b)}}]),angular.module("cf").controller("CFVocabularyCtrl",["$scope","$window","$filter","CF","$modal","$rootScope","VocabularyService",function(a,b,c,d,e,f,g){a.selectedTableDef=null,a.tmpTableElements=[],a.testCase=d.testCase,a.sourceData=[],a.selectedItem=[],a.error=null,a.vocabResError=null,a.loading=!1,a.searchError=null,a.error=null,a.searchString=null,a.selectionCriteria="TableId",a.tableLibraries=[],a.cf=d,a.init=function(){f.$on("cf:testCaseLoaded",function(){a.loading=!0;var b=angular.fromJson(d.testCase.testContext.valueSetLibrary.json);angular.forEach(b,function(a){angular.forEach(a.children,function(a){a.tableSet.tableDefinitions=c("orderBy")(a.tableSet.tableDefinitions,"tdId")})}),a.tableLibraries=c("orderBy")(b,"position"),a.loading=!1}),a.$watch(function(){return a.cf.searchTableId},function(b){if(0!=b){var c=(new g).searchTablesById(b,a.tableLibraries),d=c.length>0?c[0]:null;null!=d&&a.openTableDlg(d)}})},a.openTableDlg=function(a){e.open({templateUrl:"TableFoundCtrl.html",controller:"TableFoundCtrl",windowClass:"app-modal-window",resolve:{table:function(){return a}}})},a.searchTableValues=function(){a.selectedTableDef=null,a.selectedTableLibrary=null,a.searchResults=[],a.tmpSearchResults=[],null!=a.searchString&&(a.searchResults=(new g).searchTableValues(a.searchString,a.selectionCriteria,a.tableLibraries),a.vocabResError=null,a.selectedTableDef=null,a.tmpTableElements=null,0==a.searchResults.length?a.vocabResError="No results found for entered search criteria.":1!==a.searchResults.length||"TableId"!==a.selectionCriteria&&"ValueSetName"!==a.selectionCriteria&&"ValueSetCode"!==a.selectionCriteria||a.selectTableDef2(a.searchResults[0]),a.tmpSearchResults=[].concat(a.searchResults))},a.selectTableDef=function(b,d){a.searchResults=[],a.selectionCriteria="TableId",a.searchString=null,a.selectedTableDef=b,a.selectedTableLibrary=d,a.selectedTableDef.tableElements=c("orderBy")(a.selectedTableDef.tableElements,"code"),a.tmpTableElements=[].concat(a.selectedTableDef.tableElements)},a.clearSearchResults=function(){a.searchResults=null,a.selectedTableDef=null,a.vocabResError=null,a.tmpTableElements=null,a.tmpSearchResults=null},a.selectTableDef2=function(b){a.selectedTableDef=b,a.selectedTableDef.tableElements=c("orderBy")(a.selectedTableDef.tableElements,"code"),a.tmpTableElements=[].concat(a.selectedTableDef.tableElements)},a.isNoValidation=function(){return null!=a.selectedTableDef&&a.selectedTableLibrary&&a.selectedTableLibrary.noValidation&&a.selectedTableLibrary.noValidation.ids&&a.selectedTableLibrary.noValidation.ids.indexOf(a.selectedTableDef.tdId)>0}}]),angular.module("cf").controller("CFVocabularyTabCtrl",["$scope","CF","$timeout",function(a){a.tableList=[],a.tmpList=[].concat(a.tableList),a.error=null,a.tableLibrary=null,a.init=function(b){b&&(a.tableLibrary=b,a.tableList=b.tableSet.tableDefinitions,a.tmpList=[].concat(a.tableList))}}]),angular.module("cb").controller("CBTestingCtrl",["$scope","$window","$rootScope","CB",function(a,b,c,d){a.loading=!0,a.error=null,a.tabs=new Array,a.setActiveTab=function(b){a.tabs[0]=!1,a.tabs[1]=!1,a.tabs[2]=!1,a.tabs[3]=!1,a.tabs[4]=!1,a.activeTab=b,a.tabs[a.activeTab]=!0},a.getTestType=function(){return d.testCase.type},a.init=function(){a.error=null,a.loading=!1,a.setActiveTab(0),c.$on("cb:testCaseLoaded",function(){null!=d.testCase&&null!=d.testCase.id&&a.setActiveTab(1)})},a.disabled=function(){return null==d.testCase||null===d.testCase.id}}]),angular.module("cb").controller("CBTestCaseCtrl",["$scope","$window","$rootScope","CB","ngTreetableParams","$timeout","CBTestCaseListLoader",function(a,b,c,d,e,f,g){a.selectedTestCase=d.selectedTestCase,a.testCase=d.testCase,a.testCases=[],a.loading=!0,a.error=null,a.createTreeStruct=function(b){b.testCases&&(b.children?angular.forEach(b.testCases,function(c){b.children.push(c),a.createTreeStruct(c)}):b.children=b.testCases,delete b.testCases),b.testCaseGroups&&(b.children?angular.forEach(b.testCaseGroups,function(c){b.children.push(c),a.createTreeStruct(c)}):b.children=b.testCaseGroups,delete b.testCaseGroups),b.testSteps&&(b.children?angular.forEach(b.testSteps,function(c){b.children.push(c),a.createTreeStruct(c)}):b.children=b.testSteps,delete b.testSteps),b.children&&angular.forEach(b.children,function(b){a.createTreeStruct(b)})},a.init=function(){a.error=null,a.loading=!0,a.params=new e({getNodes:function(b){return b&&null!=b?b.children:a.testCases},getTemplate:function(){return"CBTestCase.html"}});var b=new g;b.then(function(b){a.error=null,angular.forEach(b,function(b){a.createTreeStruct(b)}),a.testCases=b,a.params.refresh(),a.loading=!1},function(){a.loading=!1,a.error="Sorry,cannot load the test cases. Please your page and try again."})},a.refreshEditor=function(){f(function(){a.editor&&a.editor.refresh()},1e3)},a.selectTestCase=function(b){a.selectedTestCase=b,c.$broadcast("cb:testCaseSelected")},a.loadTestCase=function(){d.testCase=a.selectedTestCase,a.testCase=d.testCase,c.$broadcast("cb:testCaseLoaded")},a.downloadTestStory=function(){if(null!=a.selectedTestCase){var b=document.createElement("form");b.action="api/teststory/download",b.method="POST",b.target="_target";var c=document.createElement("input");c.name="path",c.value=a.selectedTestCase.testStory.pdfPath,b.appendChild(c);var d=document.createElement("input");d.name="title",d.value=a.selectedTestCase.name,b.appendChild(d),b.style.display="none",document.body.appendChild(b),b.submit()}}}]),angular.module("cb").controller("CBProfileViewerCtrl",["$scope","$rootScope","ngTreetableParams","CB",function(a,b,c,d){a.cb=d,a.elements=[],a.nodeData=[],a.loading=!1,a.error=null,a.profile=null,a.relevance=!0,a.trim=!0,a.getConstraintsAsString=function(a){var b="";for(var c in a)b=b+'<p style="text-align: left">'+a[c].id+" - "+a[c].description+"</p>";return b},a.showRefSegment=function(b){if(a.elements.length>0&&b)for(var c=1;c<a.elements.length;c++){var d=a.elements[c];d.id==b&&a.getNodeContent(d)}},a.show=function(b){return!a.relevance||a.relevance&&b.relevent},a.viewTable=function(b){a.cb.searchTableId=b},a.init=function(){b.$on("cb:testCaseLoaded",function(){if(null!=a.cb.testCase.testContext&&null!=a.cb.testCase.testContext.profile.json&&""!=a.cb.testCase.testContext.profile.json){a.loading=!0,a.nodeData=[],a.loading=!1,a.profile=a.cb.testCase.testContext.profile,a.elements=angular.fromJson(a.profile.json).elements;var b=null,c=!0;angular.forEach(a.elements,function(a){c&&"Datatypes"===a.name&&(b=a,c=!1)}),null!=b&&a.processDatatypes(b),a.nodeData=a.elements[0],a.params.refresh(),a.loading=!1}else a.loading=!1,a.nodeData=[],a.elements=[],a.params.refresh()}),a.params=new c({getNodes:function(b){return b?b.children:a.nodeData.children},getTemplate:function(){return"TreeNode.html"}})},a.getNodeContent=function(b){a.nodeData=b,a.params.refresh()},a.processDatatypes=function(b){angular.forEach(b.children,function(b){b.children.length>0&&angular.forEach(b.children,function(b){b.type="COMPONENT",b.icon="component.png",b.children.length>0&&angular.forEach(b.children,function(b){a.processSubComponent(b)})})})},a.processSubComponent=function(b){b.type="SUBCOMPONENT",b.icon="subcomponent.png",b.children.length>0&&angular.forEach(b.children,function(b){a.processSubComponent(b)
})}}]),angular.module("cb").controller("CBValidatorCtrl",["$scope","$http","CB","$window","HL7EditorUtils","HL7CursorUtils","$timeout","HL7TreeUtils","$modal","NewValidationResult","$rootScope","Er7MessageValidator","Er7MessageParser","ValidationResultHighlighter",function(a,b,c,d,e,f,g,h,i,j,k,l,m,n){a.cb=c,a.testCase=c.testCase,a.message=c.message,a.selectedMessage={},a.validationResult=null,a.loading=!0,a.error=null,a.vError=null,a.vLoading=!0,a.mError=null,a.mLoading=!0,a.counter=0,a.type="cb",a.loadRate=4e3,a.tokenPromise=null,a.editorInit=!1,a.nodelay=!1,a.resized=!1,a.selectedItem=null,a.validationTabs=new Array,a.activeTab=0,a.messageObject=[],a.tError=null,a.tLoading=!1,a.validationConfig={dqa:{checked:!1}},a.failuresConfig={errors:{className:"failure failure-errors",checked:!1},alerts:{className:"failure failure-alerts",checked:!1},warnings:{className:"failure failure-warnings",checked:!1},informationals:{className:"failure failure-infos",checked:!1},affirmatives:{className:"failure failure-affirmatives",checked:!1}},a.validResultHighlither=new n(a.failuresConfig,a.cb.message,a.cb.report,a.cb.tree,a.cb.editor),a.hasContent=function(){return""!=a.cb.message.content&&null!=a.cb.message.content},a.refreshEditor=function(){g(function(){a.editor.refresh()},1e3)},a.options={paramName:"file",formAcceptCharset:"utf-8",autoUpload:!0,type:"POST"},a.$on("fileuploadadd",function(b,c){(c.autoUpload||c.autoUpload!==!1&&$(this).fileupload("option","autoUpload"))&&c.process().done(function(){var b=c.files[0].name;c.url="api/hl7/message/upload";c.submit().success(function(c){a.nodelay=!0;var d=angular.fromJson(c);a.cb.message.name=b,a.cb.editor.instance.doc.setValue(d.content),a.mError=null,a.execute()}).error(function(c,d,e){a.cb.message.name=b,a.mError="Sorry, Cannot upload file: "+b+", Error: "+e}).complete(function(){})})}),a.loadMessage=function(){var b=a.cb.testCase,c=b.testContext,d=a.cb.testCase.testContext.message,e=d?d.messageContent:null;null!=c.message&&null!=e&&""!=e&&(a.nodelay=!0,a.selectedMessage=a.cb.testCase.testContext.message,null!=a.selectedMessage?a.editor.doc.setValue(a.selectedMessage.messageContent):(a.editor.doc.setValue(""),a.cb.message.id=null,a.cb.message.name=""),a.execute())},a.setLoadRate=function(b){a.loadRate=b},a.initCodemirror=function(){a.editor=CodeMirror.fromTextArea(document.getElementById("cb-textarea"),{lineNumbers:!0,fixedGutter:!0,theme:"elegant",mode:"edi",readOnly:!1,showCursorWhenSelecting:!0}),a.editor.setSize(null,300),a.editor.on("keyup",function(){g(function(){var b=a.editor.doc.getValue();a.error=null,a.tokenPromise&&(g.cancel(a.tokenPromise),a.tokenPromise=void 0),c.message.name=null,""!==b.trim()?a.tokenPromise=g(function(){a.execute()},a.loadRate):a.execute()})}),a.editor.on("dblclick",function(){g(function(){var b=f.getCoordinate(a.editor);a.cb.cursor.init(b.line,b.startIndex,b.endIndex,b.index,!0),h.selectNodeByIndex(a.cb.tree.root,c.cursor,c.message.content)})}),a.cb.editor.instance=a.editor,a.refreshEditor()},a.validateMessage=function(){if(a.validationTabs[0]=!0,a.failuresConfig.errors.checked=!1,a.failuresConfig.warnings.checked=!1,a.failuresConfig.alerts.checked=!1,a.failuresConfig.informationals.checked=!1,a.failuresConfig.affirmatives.checked=!1,a.hideAllFailures(),a.vLoading=!0,a.vError=null,null!=a.cb.testCase&&""!==a.cb.message.content)try{var b=(new l).validate(a.cb.testCase.testContext.id,a.cb.message.content,a.cb.testCase.label);b.then(function(b){a.vLoading=!1,a.setValidationResult(b)},function(b){a.vLoading=!1,a.vError=b,a.setValidationResult(null)})}catch(c){a.vLoading=!1,a.vError=c,a.setValidationResult(null)}else a.setValidationResult(null),a.vLoading=!1,a.vError=null},a.hideAllFailures=function(){a.validResultHighlither.hideAllFailures()},a.showFailures=function(b,c){a.validResultHighlither.showFailures(b,c)},a.isVFailureChecked=function(b){return a.failuresConfig[b].checked},a.setValidationResult=function(b){null!==b?(a.cb.validationResult=new j,a.cb.validationResult.init(b),a.validationResult=a.cb.validationResult,a.cb.report.result=a.validationResult,angular.equals(b,{})?(a.cb.report.result=null,a.cb.report.metaData=null):a.cb.report.metaData={reportHeader:{title:"Message Validation Report",date:(new Date).getTime()},validationTypeHeader:{title:"Validation Type",type:"Context-based"},toolHeader:{title:"Testing Tool",name:"NIST-CDC Immunization Test Suite - HL7 V2.5.1 Validation Tool",versionRelease:"1.0"},profileHeader:{name:"Profile Name",organization:"NIST",type:"See Profile MetaData Slide",profileVersion:"",profileDate:"",standard:"HL7 Version 2.5.1 Implementation Guide For Immunization Messaging Rel .1.5 (10/01/2014) Immunization Clarification Addendum (Date)"},messageHeader:{encoding:"ER7"},summaryHeader:{errorCount:a.cb.report.result.errors.categories[0].data.length,warningCount:a.cb.report.result.warnings.categories[0].data.length,informationalCount:a.cb.report.result.informationals.categories[0].data.length,alertCount:a.cb.report.result.alerts.categories[0].data.length,affirmativeCount:a.cb.report.result.affirmatives.categories[0].data.length}}):(a.cb.validationResult=null,a.validationResult=null,a.cb.report.result=null)},a.select=function(b){if(void 0!=b&&null!=b.path&&-1!=b.line){var c=h.selectNodeByPath(a.cb.tree.root,b.line,b.path),d=null!=c?c.data:null;a.cb.cursor.init(null!=d?d.lineNumber:b.line,null!=d?d.startIndex-1:b.column-1,null!=d?d.endIndex-1:b.column-1,null!=d?d.startIndex-1:b.column-1,!1),e.select(a.editor,a.cb.cursor)}},a.showDetails=function(b){var c=i.open({templateUrl:"ValidationResultDetailsCtrl.html",controller:"ValidationResultDetailsCtrl",resolve:{selectedElement:function(){return b}}});c.result.then(function(b){a.selectedElement=b},function(){})},a.clearMessage=function(){a.nodelay=!0,a.mError=null,a.editor&&(a.editor.doc.setValue(""),a.execute())},a.saveMessage=function(){a.cb.message.download()},a.parseMessage=function(){if(a.tLoading=!0,null!=a.cb.testCase&&""!=a.cb.message.content){var b=(new m).parse(a.cb.testCase.testContext.id,a.cb.message.content,a.cb.testCase.label);b.then(function(b){a.tLoading=!1,a.messageObject=b},function(b){a.tLoading=!1,a.tError=b})}else a.messageObject=[],a.tError=null,a.tLoading=!1},a.onNodeSelect=function(b){var c=h.getEndIndex(b,a.cb.message.content);a.cb.cursor.init(b.data.lineNumber,b.data.startIndex-1,c-1,b.data.startIndex-1,!1),e.select(a.editor,a.cb.cursor)},a.execute=function(){a.error=null,a.tError=null,a.mError=null,a.vError=null,a.cb.message.content=a.editor.doc.getValue(),a.validateMessage(),a.parseMessage()},a.init=function(){a.vLoading=!1,a.tLoading=!1,a.mLoading=!1,a.error=null,a.tError=null,a.mError=null,a.vError=null,a.initCodemirror(),a.setValidationResult({}),a.$on("cb:refreshEditor",function(b){a.refreshEditor(),b.preventDefault()}),k.$on("cb:testCaseLoaded",function(){a.refreshEditor(),a.testCase=a.cb.testCase,null!=a.testCase&&a.clearMessage()})}}]),angular.module("cb").controller("CBReportCtrl",["$scope","$sce","$http","CB",function(a,b,c,d){a.cb=d,a.error=null,a.loading=!1,a.init=function(){},a.downloadAs=function(b){a.cb.report.downloadByFormat(a.cb.report,b)}}]),angular.module("cb").controller("CBVocabularyCtrl",["$scope","$window","$filter","CB","$modal","$rootScope","VocabularyService",function(a,b,c,d,e,f,g){a.cb=d,a.selectedTableDef=null,a.tmpTableElements=[],a.testCase=d.testCase,a.sourceData=[],a.selectedItem=[],a.error=null,a.vocabResError=null,a.loading=!1,a.searchError=null,a.error=null,a.searchString=null,a.selectionCriteria="TableId",a.tableLibraries=[],a.init=function(){f.$on("cb:testCaseLoaded",function(){a.loading=!0;var b=angular.fromJson(d.testCase.testContext.valueSetLibrary.json);angular.forEach(b,function(a){angular.forEach(a.children,function(a){a.tableSet.tableDefinitions=c("orderBy")(a.tableSet.tableDefinitions,"tdId")})}),a.tableLibraries=c("orderBy")(b,"position"),a.loading=!1}),a.$watch(function(){return a.cb.searchTableId},function(b){if(0!=b){var c=(new g).searchTablesById(b,a.tableLibraries),d=c.length>0?c[0]:null;null!=d&&a.openTableDlg(d)}})},a.openTableDlg=function(a){e.open({templateUrl:"TableFoundCtrl.html",controller:"TableFoundCtrl",windowClass:"app-modal-window",resolve:{table:function(){return a}}})},a.searchTableValues=function(){a.selectedTableDef=null,a.selectedTableLibrary=null,a.searchResults=[],a.tmpSearchResults=[],null!=a.searchString&&(a.searchResults=(new g).searchTableValues(a.searchString,a.selectionCriteria,a.tableLibraries),a.vocabResError=null,a.selectedTableDef=null,a.tmpTableElements=null,0==a.searchResults.length?a.vocabResError="No results found for entered search criteria.":1!==a.searchResults.length||"TableId"!==a.selectionCriteria&&"ValueSetName"!==a.selectionCriteria&&"ValueSetCode"!==a.selectionCriteria||a.selectTableDef2(a.searchResults[0]),a.tmpSearchResults=[].concat(a.searchResults))},a.selectTableDef=function(b,d){a.searchResults=[],a.selectionCriteria="TableId",a.searchString=null,a.selectedTableDef=b,a.selectedTableLibrary=d,a.selectedTableDef.tableElements=c("orderBy")(a.selectedTableDef.tableElements,"code"),a.tmpTableElements=[].concat(a.selectedTableDef.tableElements)},a.clearSearchResults=function(){a.searchResults=null,a.selectedTableDef=null,a.vocabResError=null,a.tmpTableElements=null,a.tmpSearchResults=null},a.selectTableDef2=function(b){a.selectedTableDef=b,a.selectedTableDef.tableElements=c("orderBy")(a.selectedTableDef.tableElements,"code"),a.tmpTableElements=[].concat(a.selectedTableDef.tableElements)},a.isNoValidation=function(){return null!=a.selectedTableDef&&a.selectedTableLibrary&&a.selectedTableLibrary.noValidation&&a.selectedTableLibrary.noValidation.ids&&a.selectedTableLibrary.noValidation.ids.indexOf(a.selectedTableDef.tdId)>0}}]),angular.module("cb").controller("CBVocabularyTabCtrl",["$scope","CB","$timeout",function(a){a.tableList=[],a.tmpList=[].concat(a.tableList),a.error=null,a.tableLibrary=null,a.init=function(b){b&&(a.tableLibrary=b,a.tableList=b.tableSet.tableDefinitions,a.tmpList=[].concat(a.tableList))}}]),angular.module("envelope").controller("EnvelopeTestingCtrl",["$scope","$window","$rootScope","Envelope",function(a,b,c,d){a.loading=!1,a.error=null,a.tabs=new Array,a.setActiveTab=function(b){a.tabs[0]=!1,a.tabs[1]=!1,a.tabs[2]=!1,a.activeTab=b,a.tabs[a.activeTab]=!0},a.init=function(){a.setActiveTab(0)},c.$on("env:testCaseLoaded",function(){null!=d.testCase&&null!=d.testCase.id&&a.setActiveTab(1)}),a.hasContent=function(){return""!=d.getContent()&&null!=d.getContent()},a.disabled=function(){return null==d.testCase||null===d.testCase.id}}]),angular.module("envelope").controller("EnvelopeTestCaseCtrl",["$scope","$window","$rootScope","Envelope","ngTreetableParams","EnvelopeTestCaseListLoader",function(a,b,c,d,e,f){a.selectedTestCase=d.selectedTestCase,a.testCase=d.testCase,a.testCases=[],a.loading=!0,a.error=null,a.testCaseTree={},a.init=function(){a.error=null,a.testCases=[],a.loading=!0,a.params=new e({getNodes:function(b){return b&&null!=b?b.children:a.testCases},getTemplate:function(){return"SOAPTestCase.html"}});var b=new f;b.then(function(b){a.error=null,a.testCases=b,a.params.refresh(),a.loading=!1},function(){a.loading=!1,a.error="Sorry,Cannot fetch the test cases. Please refresh the page."})},a.refreshEditor=function(){a.$broadcast("envelope:editor:init")},a.selectTestCase=function(b){a.selectedTestCase=b,c.$broadcast("env:testCaseSelected")},a.loadTestCase=function(){d.testCase=a.selectedTestCase,a.testCase=d.testCase,c.$broadcast("env:testCaseLoaded")}}]),angular.module("envelope").controller("EnvelopeValidatorCtrl",["$scope","$http","$window","XmlFormatter","Envelope","XmlEditorUtils","$rootScope","XmlParser","XmlTreeUtils","EnvelopeValidator","$timeout",function(a,b,c,d,e,f,g,h,i,j,k){a.testCase=e.testCase,a.selectedTestCase=e.selectedTestCase,a.vLoading=!0,a.vError=null,a.selectedMessage={id:-1,content:""},a.eLoading=!1,a.validating=!1,a.editorInit=!1,a.eError=null,a.rLoading=!1,a.rError=null,a.resized=!1,a.validationSettings=e.validationSettings,a.validationResult=e.validationResult,a.envelopeObject=[],a.tError=null,a.envelopeTree={},a.tLoading=!1,a.refreshEditor=function(){void 0!=a.editor&&k(function(){a.editor.refresh()},1e3)},a.loadExampleMessage=function(){var b=e.testCase.testContext.exampleMessage.messageContent,c=new d(b);c.then(function(a){e.setContent(a)},function(c){a.error=c,e.setContent(b)})},a.validate=function(){a.error=null;var b=e.editor.instance.doc.getValue();if(""!=b){a.validating=!0;var c=new d(b);c.then(function(b){a.validating=!1,e.setContent(b)},function(b){a.validating=!1,a.error=b})}else e.setContent("")},a.init=function(){a.editor=CodeMirror.fromTextArea(document.getElementById("envelopeTextArea"),{lineNumbers:!0,fixedGutter:!0,mode:"xml",readOnly:!1,showCursorWhenSelecting:!0}),a.editor.on("dblclick",function(b){a.$apply(function(){e.cursor.setLine(b.doc.getCursor(!0).line+1)}),event.preventDefault()}),a.editor.setSize(null,300),e.editor.init(a.editor),a.tLoading=!1,a.$watch(function(){return e.cursor.updateIndicator},function(){f.select(e.cursor,a.editor)},!0),a.$watch(function(){return e.cursor.toString()},function(){i.selectNode(a.envelopeTree,e.cursor)},!0),a.$watch(function(){return a.envelopeObject},function(){i.expandTree(a.envelopeTree)},!0),a.$on("envelope:editor:dblclick",function(){}),a.$on("refreshPanel",function(){a.refreshEditor()}),g.$on("env:testCaseLoaded",function(){a.testCase=e.testCase,a.clearMessage(),a.refreshEditor(),a.validateMessage(),a.parse()}),a.$watch(function(){return e.message.updateIndicator},function(b){"0"!==b&&(a.validateMessage(),a.parse())},!0),a.setValidationResult({}),a.refreshEditor()},a.options={paramName:"file",formAcceptCharset:"utf-8",autoUpload:!0,type:"POST"},a.$on("fileuploadadd",function(b,c){(c.autoUpload||c.autoUpload!==!1&&$(this).fileupload("option","autoUpload"))&&c.process().done(function(){var b=c.files[0].name;c.url="api/soap/upload";c.submit().success(function(c){angular.fromJson(c);e.setContent(c.content),a.$broadcast("envelope:editor:update",!0),a.uploadError=null,a.fileName=b}).error(function(c,d,e){a.fileName=b,a.uploadError="Sorry, Cannot upload file: "+b+", Error: "+e}).complete(function(){})})}),a.getMessageName=function(){return e.message.name},a.clearMessage=function(){a.error=null,e.setContent("")},a.saveMessage=function(){e.message.download()},a.resize=function(){},a.validateMessage=function(){if(a.rLoading=!0,a.rError=null,null!=e.testCase.id&&null!=e.editor.instance&&""!=e.editor.instance.doc.getValue()){var b=(new j).validate(e.message.content,e.testCase.id);b.then(function(b){a.rLoading=!1,a.setValidationResult(b)},function(b){a.rLoading=!1,a.rError=b,a.setValidationResult({})})}else a.setValidationResult({}),a.rLoading=!1,a.rError=null},a.setValidationResult=function(a){e.validationResult.init(a)},a.select=function(a){-1!=a.line&&e.cursor.setLine(a.line)},a.parse=function(){if(a.tLoading=!0,a.envelopeObject=[],a.tError=null,null!==e.testCase.id&&""!=e.getContent()){var b=new h(e.getContent());b.then(function(b){a.tLoading=!1,a.envelopeObject=b},function(b){a.tLoading=!1,a.tError=b})}else a.tLoading=!1},a.onEnvelopeNodeSelect=function(a){i.setCoordinate(a,e.cursor)}}]),angular.module("envelope").controller("EnvelopeReportCtrl",["$scope","$sce","$http","Envelope","SoapValidationReportGenerator","SoapValidationReportDownloader","$rootScope",function(a,b,c,d,e,f,g){a.envelopeHtmlReport=null,a.error=null,a.loading=!1,a.testCase=d.testCase,a.init=function(){a.$watch(function(){return d.validationResult.xml},function(c){if(null!=c&&""!=c){a.loading=!0;var d=new e(c,"html");d.then(function(c){a.envelopeHtmlReport=b.trustAsHtml(c.htmlReport),a.loading=!1,a.error=null},function(b){a.error=b,a.loading=!1,a.envelopeHtmlReport=null})}else a.loading=!1,a.envelopeHtmlReport=null,a.error=null},!0),g.$on("env:testCaseLoaded",function(){a.testCase=d.testCase})},a.downloadAs=function(a){f.downloadAs(d.validationResult.xml,a)}}]),angular.module("profile-viewer").controller("ProfileCtrl",["$scope","ProfileLoader","ProfileListLoader","ProfileModelLoader","ngTreetableParams",function(a,b,c,d,e){a.loading=!1,a.currentProfile={},a.selectedProfile={},a.elements=[],a.nodeData=[],a.loading=!1,a.error=null,a.relevance=!0,a.trim=!0,a.getConfStatementsAsString=function(a){var b="",c=a.conformanceStatement;for(var d in c)b=b+'<p style="text-align: left">'+c[d].id+" - "+c[d].englishDescription+"</p>";return b},a.show=function(b){return!a.relevance||a.relevance&&("R"===b||"RE"===b||"C"===b||void 0==b||b.startsWith("C"))},a.loadProfiles=function(){a.loading=!0;var b=new c;b.then(function(b){a.profiles=angular.fromJson(b),a.loading=!1},function(b){a.error=b,a.loading=!1})},a.selectProfile=function(){a.currentProfile.id=null!=a.selectedProfile?a.selectedProfile.id:-1},a.init=function(){a.loadProfiles(),a.params=new e({getNodes:function(b){return b?b.children:a.nodeData.children},getTemplate:function(){return"TreeNode.html"}}),a.$watch("selectedProfile",function(){if(a.loading=!0,a.nodeData=[],null!=a.selectedProfile&&void 0!=a.selectedProfile.id&&-1!=a.selectedProfile.id){var b=angular.fromJson(a.selectedProfile),c=new d(b.id);c.then(function(b){a.loading=!1,a.elements=b.elements,a.nodeData=a.elements[0],a.params.refresh()},function(b){a.elements=[],a.loading=!1,a.error=b,a.params.refresh()})}else a.elements=[],a.loading=!1,a.params.refresh()},!0)},a.getNodeContent=function(b){a.nodeData=b,a.params.refresh()}}]),angular.module("doc").controller("DocumentationCtrl",["$scope",function(a){a.init=function(){}}]),angular.module("tool").controller("ContactCtrl",["$scope","ContactLoader","ContactListLoader",function(a,b,c){a.init=function(){var b=new c;return b.then(function(b){a.contacts=b},function(b){a.error=b}),b}}]),angular.module("tool").controller("AboutCtrl",["$scope","AppInfo",function(){}]),angular.module("tool").controller("HeaderCtrl",["$scope","$location",function(){}]),angular.module("connectivity").controller("ConnectivityTestingCtrl",["$scope","Connectivity","$rootScope",function(a,b,c){a.tabs=new Array,a.loading=!1,a.setActiveTab=function(b){a.tabs[0]=!1,a.tabs[1]=!1,a.activeTab=b,a.tabs[a.activeTab]=!0,a.$broadcast("refreshPanel")},a.init=function(){a.setActiveTab(0)},c.$on("conn:testCaseLoaded",function(){a.setActiveTab(1)}),a.disabled=function(){return null==b.testCase||null===b.testCase.id}}]),angular.module("connectivity").controller("ConnectivityTestCaseCtrl",["$scope","Connectivity","ngTreetableParams","$rootScope","ConnectivityTestCaseListLoader",function(a,b,c,d,e){a.connectivity=b,a.loading=!0,a.error=null,a.testCases=[],a.testCase=b.testCase,a.selectedTestCase=b.selectedTestCase,a.testCaseTree={},a.selectTestCase=function(b){a.selectedTestCase=b,d.$broadcast("conn:testCaseSelected")},a.init=function(){a.error=null,a.loading=!0,a.testCases=[],a.params=new c({getNodes:function(b){return b&&null!=b?b.children:a.testCases},getTemplate:function(){return"SOAPTestCase.html"}});var b=new e;b.then(function(b){a.testCases=b,a.params.refresh(),a.loading=!1,a.error=null},function(){a.error="Sorry, Failed to fetch the test cases. Please refresh page and try again.",a.loading=!1})},a.loadTestCase=function(){b.testCase=a.selectedTestCase,a.testCase=b.testCase,d.$broadcast("conn:testCaseLoaded")}}]),angular.module("connectivity").controller("ConnectivityExecutionCtrl",["$scope","$timeout","$interval","Connectivity","$rootScope","$modal",function(a,b,c,d,e,f){a.logger=d.logger,a.loading=!1,a.testCase=d.testCase,a.selectedTestCase=d.selectedTestCase,a.loading=!1,a.connecting=!1,a.error=null,a.user=d.user,a.hidePwd=!0,a.init=function(){e.$on("conn:testCaseLoaded",function(){a.testCase=d.testCase,a.logger.init(),a.loading=!0,a.error=null,a.connecting=!1,"RECEIVER"==d.testCase.sutType?a.initOutgoingEnvironment():a.initIncomingEnvironment()}),d.user.init().then(function(){},function(b){a.error=b})},a.log=function(b){a.logger.log(b)},a.initOutgoingEnvironment=function(){a.logger.clear(),d.response.setContent(""),d.request.setContent(d.testCase.testContext.message)},a.initIncomingEnvironment=function(){d.request.setContent(""),d.response.setContent(""),a.logger.clear(),a.error=null},a.isValidConfig=function(){return null!=a.user.receiverEndpoint&&""!=a.user.receiverEndpoint},a.openReceiverConfig=function(){a.logger.init();var b=f.open({templateUrl:"ConnectivityReceiverCtrl.html",controller:"ConnectivityReceiverCtrl",windowClass:"app-modal-window",resolve:{testCase:function(){return d.testCase},logger:function(){return d.logger},message:function(){return d.request.getContent()},user:function(){return d.user},endpoint:function(){return d.serverEndpoint}}});b.result.then(function(a){null!=a.received&&d.request.setContent(a.received),null!=a.sent&&d.response.setContent(a.sent)},function(){d.response.setContent(""),d.request.setContent("")})},a.send=function(){a.logger.init();var b=f.open({templateUrl:"ConnectivitySenderCtrl.html",controller:"ConnectivitySenderCtrl",size:"lg",backdrop:"static",resolve:{testCase:function(){return d.testCase},logger:function(){return d.logger},message:function(){return d.request.editor.getContent()},user:function(){return d.user}}});b.result.then(function(a){null!=a.sent&&d.request.setContent(a.sent),null!=a.received&&d.response.setContent(a.received)},function(){d.response.setContent("")})},a.configureReceiver=function(){var a=f.open({templateUrl:"ConnectivityConfigureReceiverCtrl.html",controller:"ConnectivityConfigureReceiverCtrl",resolve:{testCase:function(){return d.testCase},user:function(){return d.user}}});a.result.then(function(a){d.user.senderUsername=a.senderUsername,d.user.senderPassword=a.senderPassword,d.user.senderFacilityID=a.senderFacilityID,d.user.receiverUsername=a.receiverUsername,d.user.receiverPassword=a.receiverPassword,d.user.receiverFacilityId=a.receiverFacilityId,d.user.receiverEndpoint=a.receiverEndpoint,d.response.setContent("")},function(){d.response.setContent("")})},a.viewReceiver=function(){var a=f.open({templateUrl:"ConnectivityViewReceiverConfigurationCtrl.html",controller:"ConnectivityViewReceiverConfigurationCtrl",windowClass:"app-modal-window",resolve:{testCase:function(){return d.testCase},user:function(){return d.user}}});a.result.then(function(){d.response.setContent("")},function(){d.response.setContent("")})},a.hasRequestContent=function(){return null!=d.request.getContent()&&""!=d.request.getContent()}}]),angular.module("connectivity").controller("ConnectivityReqCtrl",["$scope","$http","Connectivity","XmlFormatter","$window","XmlEditorUtils","$timeout","$rootScope","ConnectivityValidator","$modal",function(a,b,c,d,e,f,g,h,i){a.eLoading=!1,a.vError=null,a.request=c.request,a.editor=null,a.request=c.request,a.validating=!1,a.editorInit=!1,a.serverEndpoint=c.serverEndpoint,a.user=c.user,a.request=c.request,a.rLoading=!1,a.rError=null,a.resized=!1,a.validationSettings=a.request.validationSettings,a.validationResult=a.request.validationResult,a.editor=a.request.editor,a.itemsByPage=10,a.errors=a.validationResult.errors,a.errorsCollection=[].concat(a.errors.data),a.affirmatives=a.validationResult.affirmatives,a.affirmativesCollection=[].concat(a.affirmatives.data),a.alerts=a.validationResult.alerts,a.alertsCollection=[].concat(a.alerts.data),a.ignores=a.validationResult.ignores,a.ignoresCollection=[].concat(a.ignores.data),a.warnings=a.validationResult.warnings,a.warningsCollection=[].concat(a.warnings.data),a.selectedExampleMessage={id:-1,content:""},a.error=null,a.options={paramName:"file",formAcceptCharset:"utf-8",autoUpload:!0,type:"POST"},a.hasContent=function(){return""!=a.request.getContent()&&null!=a.request.getContent()},a.getMessageName=function(){return a.editor.message.name},a.$on("fileuploadadd",function(b,c){(c.autoUpload||c.autoUpload!==!1&&$(this).fileupload("option","autoUpload"))&&c.process().done(function(){var b=c.files[0].name;c.url="api/soap/upload";c.submit().success(function(c){var d=angular.fromJson(c);a.request.editor.doc.setValue(d.content),a.$broadcast("connectivityReq:editor:update",!0),a.uploadError=null,a.fileName=b}).error(function(c,d,e){a.fileName=b,a.uploadError="Sorry, Failed to upload file: "+b+", Error: "+e}).complete(function(){})})}),a.validate=function(){a.vError=null;var b=a.request.editor.instance.doc.getValue();if(null!=b&&""!=b){a.validating=!0;var c=new d(b);c.then(function(b){a.validating=!1,a.request.setContent(b)},function(b){a.validating=!1,a.vError=b})}},a.clearMessage=function(){a.error=null,a.request.setContent(""),a.refreshEditor()},a.refreshEditor=function(){void 0!=a.editor&&g(function(){a.editor.refresh()},1e3)},a.saveMessage=function(){a.request.message.download()},a.resize=function(){},a.validateMessage=function(){if(a.rLoading=!0,a.rError=null,null!=a.testCase.id&&""!=a.request.getContent()){var b=(new i).validate(a.request.message.content,a.testCase.id,c.user.id,"req",null);b.then(function(b){a.rLoading=!1,a.setValidationResult(b)},function(b){a.rLoading=!1,a.rError=b,a.setValidationResult({})})}else a.setValidationResult({}),a.rLoading=!1,a.rError=null},a.setValidationResult=function(b){a.request.validationResult.init(b),a.validationResult=a.request.validationResult,a.errors=a.validationResult.errors,a.affirmatives=a.validationResult.affirmatives,a.alerts=a.validationResult.alerts,a.ignores=a.validationResult.ignores,a.warnings=a.validationResult.warnings},a.select=function(a){-1!=a.line&&c.request.cursor.setLine(a.line)},a.init=function(){a.error=null,a.loading=!0,a.editor=CodeMirror.fromTextArea(document.getElementById("connectivityReqTextArea"),{lineNumbers:!0,fixedGutter:!0,mode:"xml",readOnly:!1,showCursorWhenSelecting:!0}),a.editor.setOption("readOnly",!0),a.editor.setSize(null,300),a.editor.on("dblclick",function(){a.$apply(function(){a.request.cursor.setLine(a.editor.doc.getCursor(!0).line+1)}),event.preventDefault()}),a.request.editor.init(a.editor),h.$on("conn:testCaseLoaded",function(){a.testCase=c.testCase,"RECEIVER"==c.testCase.sutType&&c.request.setContent(c.testCase.testContext.message),a.refreshEditor(),a.validateMessage()}),a.$watch(function(){return a.request.cursor.updateIndicator},function(){f.select(a.request.cursor,a.request.editor.instance)},!0),a.$watch(function(){return a.request.editor.instance.doc.getValue()},function(b){a.request.message.content=b},!0),a.$watch(function(){return a.request.message.updateIndicator},function(b){"0"!==b&&a.validateMessage()},!0),a.setValidationResult({}),a.refreshEditor()}}]),angular.module("connectivity").controller("ConnectivityReqReportCtrl",["$scope","$sce","$http","SoapValidationReportGenerator","SoapValidationReportDownloader","Connectivity","$rootScope",function(a,b,c,d,e,f,g){a.connectivityReqHtmlReport=null,a.error=null,a.loading=!1,a.testCase=f.testCase,a.validationResult=f.validationResult,a.init=function(){g.$on("conn:testCaseLoaded",function(){a.testCase=f.testCase}),a.$watch(function(){return a.validationResult.xml},function(c){if(null!=c&&""!=c){a.loading=!0;var e=new d(c,"html");e.then(function(c){a.connectivityReqHtmlReport=b.trustAsHtml(c.htmlReport),a.loading=!1,a.error=null},function(b){a.error=b,a.loading=!1,a.connectivityReqHtmlReport=null})}else a.loading=!1,a.connectivityReqHtmlReport=null,a.error=null},!0)},a.downloadAs=function(b){e.downloadAs(a.validationResult.xml,b)}}]),angular.module("connectivity").controller("ConnectivityConfigureReceiverCtrl",["$scope","$sce","$http","Connectivity","$rootScope","$modalInstance","testCase","user",function(a,b,c,d,e,f,g,h){a.testCase=g,a.user=angular.copy(h),a.save=function(){f.close(a.user)},a.cancel=function(){f.dismiss("cancel")},a.hasRequestContent=function(){return null!=a.message&&""!=a.message}}]),angular.module("connectivity").controller("ConnectivityViewReceiverConfigurationCtrl",["$scope","$sce","$http","Connectivity","$rootScope","$modalInstance","testCase","ConnectivityInitiator","message","user","logger",function(a,b,c,d,e,f,g,h,i,j){a.testCase=g,a.user=j,a.close=function(){f.close()},a.cancel=function(){f.dismiss("cancel")},a.hasRequestContent=function(){return null!=a.message&&""!=a.message}}]),angular.module("connectivity").controller("ConnectivitySenderCtrl",["$scope","$sce","$http","Connectivity","$rootScope","$modalInstance","testCase","ConnectivityInitiator","message","user","logger",function(a,b,c,d,e,f,g,h,i,j,k){a.testCase=g,a.message=i,a.user=j,a.logger=k,a.sent=null,a.received=null,a.connecting=!1,a.error=null,a.isValidConfig=function(){return null!=a.user.receiverEndpoint&&""!=a.user.receiverEndpoint},a.close=function(){f.close({sent:a.sent,received:a.received})},a.cancel=function(){f.dismiss("cancel")},a.hasRequestContent=function(){return null!=a.message&&""!=a.message},a.send=function(){if(a.error=null,""!=a.user.receiverEndpoint&&a.hasRequestContent()){a.connecting=!0,a.logger.init(),a.received="",a.logger.log("Sending request ========================>");var b=(new h).send(a.user,a.testCase.id,a.message);b.then(function(b){var c=b.incoming,d=b.outgoing;a.logger.log("Outgoing message sent successfully."),a.logger.log("Outgoing message is:"),a.logger.log(d),a.logger.log("Incoming message received <========================"),a.logger.log("Incoming message is:"),a.logger.log(c),a.logger.log("Transaction completed"),a.connecting=!1,a.sent=d,a.received=c},function(b){a.connecting=!1,a.error=b.data,a.logger.log("Error: "+b.data),a.logger.log("Transaction aborted"),d.response.setContent(""),a.received=""})}else a.error="No outgoing message found"},a.send()}]),angular.module("connectivity").controller("ConnectivityRespCtrl",["$scope","$http","Connectivity","$window","XmlFormatter","XmlEditorUtils","$timeout","$rootScope","ConnectivityValidator","$modal",function(a,b,c,d,e,f,g,h,i){a.testCase=c.testCase,a.response=c.response,a.selectedTestCase=c.selectedTestCase,a.loading=!0,a.error=null,a.eLoading=!1,a.validating=!1,a.editorInit=!1,a.rLoading=!1,a.rError=null,a.resized=!1,a.validationSettings=c.response.validationSettings,a.validationResult=c.response.validationResult,a.itemsByPage=10,a.errors=a.validationResult.errors,a.errorsCollection=[].concat(a.errors.data),a.affirmatives=a.validationResult.affirmatives,a.affirmativesCollection=[].concat(a.affirmatives.data),a.alerts=a.validationResult.alerts,a.alertsCollection=[].concat(a.alerts.data),a.ignores=a.validationResult.ignores,a.ignoresCollection=[].concat(a.ignores.data),a.warnings=a.validationResult.warnings,a.warningsCollection=[].concat(a.warnings.data),a.options={paramName:"file",formAcceptCharset:"utf-8",autoUpload:!0,type:"POST"},a.error=null,a.init=function(){a.error=null,a.testCases=[],a.loading=!0,a.editor=CodeMirror.fromTextArea(document.getElementById("connectivityRespTextArea"),{lineNumbers:!0,fixedGutter:!0,mode:"xml",readOnly:!1,showCursorWhenSelecting:!0}),a.editor.setOption("readOnly",!0),a.editor.setSize(null,300),a.editor.on("dblclick",function(){a.$apply(function(){a.response.cursor.setLine(a.editor.doc.getCursor(!0).line+1)}),event.preventDefault()}),a.response.editor.init(a.editor),a.$watch(function(){return a.response.cursor.updateIndicator},function(){f.select(a.response.cursor,a.editor)},!0),h.$on("conn:testCaseLoaded",function(){a.testCase=c.testCase,a.refreshEditor(),a.clearMessage()}),a.$watch(function(){return a.response.editor.instance.doc.getValue()
},function(b){a.response.message.content=b},!0),a.$watch(function(){return c.response.message.updateIndicator},function(b){b&&"0"!==b&&a.validateMessage()},!0),a.setValidationResult({}),a.refreshEditor()},a.hasContent=function(){return""!=a.response.getContent()&&null!=a.response.getContent()},a.getMessageName=function(){return a.response.message.name},a.clearMessage=function(){a.error=null,a.response.setContent(""),a.refreshEditor()},a.refreshEditor=function(){void 0!=a.editor&&g(function(){a.editor.refresh()},1e3)},a.saveMessage=function(){a.response.message.download()},a.validate=function(){a.error=null;var b=a.response.editor.instance.doc.getValue();if(null!=b&&""!=b){a.validating=!0;var c=new e(b);c.then(function(b){a.validating=!1,a.response.setContent(b)},function(b){a.validating=!1,a.error=b})}},a.resize=function(){},a.validateMessage=function(){if(a.rLoading=!0,a.rError=null,null!=c.testCase.id&&""!=c.response.getContent()){var b=(new i).validate(a.response.message.content,c.testCase.id,c.user.id,"resp",c.request.getContent());b.then(function(b){a.rLoading=!1,a.setValidationResult(b)},function(b){a.rLoading=!1,a.rError=b,a.setValidationResult({})})}else a.setValidationResult({}),a.rLoading=!1,a.rError=null},a.setValidationResult=function(b){a.response.validationResult.init(b),a.validationResult=a.response.validationResult,a.errors=a.validationResult.errors,a.affirmatives=a.validationResult.affirmatives,a.alerts=a.validationResult.alerts,a.ignores=a.validationResult.ignores,a.warnings=a.validationResult.warnings},a.select=function(a){-1!=a.line&&c.response.cursor.setLine(a.line)}}]),angular.module("connectivity").controller("ConnectivityRespReportCtrl",["$scope","$sce","$http","SoapValidationReportGenerator","SoapValidationReportDownloader","Connectivity",function(a,b,c,d,e,f){a.connectivityRespHtmlReport=null,a.error=null,a.loading=!1,a.testCase=f.testCase,a.init=function(){a.$watch(function(){return f.response.validationResult.xml},function(c){if(null!=c&&""!=c){a.loading=!0;var e=new d(c,"html");e.then(function(c){a.connectivityRespHtmlReport=b.trustAsHtml(c.htmlReport),a.loading=!1,a.error=null},function(b){a.error=b,a.loading=!1,a.connectivityRespHtmlReport=null})}else a.loading=!1,a.connectivityRespHtmlReport=null,a.error=null},!0)},a.downloadAs=function(a){e.downloadAs(f.response.validationResult.xml,a)}}]),angular.module("connectivity").controller("ConnectivityReceiverCtrl",["$scope","$sce","$http","Connectivity","$rootScope","$modalInstance","testCase","user","logger","ConnectivityClock","endpoint","message",function(a,b,c,d,e,f,g,h,i,j,k,l){a.testCase=g,a.user=h,a.logger=i,a.endpoint=k,a.message=l,a.sent=null,a.received=null,a.connecting=!1,a.error=null,a.counterMax=30,a.counter=0,a.listenerReady=!1,a.log=function(b){a.logger.log(b)},a.close=function(){f.close({sent:a.sent,received:a.received})},a.cancel=function(){f.dismiss("cancel")},a.hasRequestContent=function(){return null!=a.message&&""!=a.message},a.stop=function(){a.connecting=!1,a.counter=a.counterMax,j.stop(),a.log("Stopping transaction. Please wait...."),a.user.transaction.closeConnection().then(function(){a.log("Transaction stopped.")},function(){})},a.start=function(){a.logger.clear(),a.counter=0,a.connecting=!0,a.received="",a.sent="",a.error=null,a.log("Configuring connection. Please wait..."),d.user.transaction.openConnection().then(function(){a.log("Connection configured.");var b=function(){++a.counter,a.log("Waiting for incoming message....Elapsed time(second):"+a.counter+"s"),a.user.transaction.messages().then(function(){var b=a.user.transaction.incoming,c=a.user.transaction.outgoing;a.counter<a.counterMax?(null!=b&&""!=b&&""==a.received&&(a.log("Incoming Message Received <--------------------------------------"),a.log(b),a.received=b),null!=c&&""!=c&&""==a.sent&&(a.log("Outgoing Message Sent:    -------------------------------------->"),a.log(c),a.sent=c),""!=a.received&&""!=a.sent&&a.stop()):(null==b||""==b?a.log("We did not receive any incoming message after 30s or you are using wrong credentials."):(null==c||""==c)&&a.log("We were unable to send the response after 30s"),a.stop())},function(b){a.error=b,a.log("Error: "+b),a.received="",a.sent="",a.stop()})};j.start(b)},function(b){a.log("Failed to configure incoming connection: Error: "+b),a.log("Transaction aborted"),a.connecting=!1,a.error=b})}}]),angular.module("tool-directives").directive("hl7editor",["$timeout",function(){return{restrict:"A",link:function(a,b,c){a.editor=CodeMirror.fromTextArea(document.getElementById(c.id),{lineNumbers:!0,fixedGutter:!0,theme:"elegant",mode:"edi",readOnly:void 0!=c.readonly&&c.readonly,showCursorWhenSelecting:!0}),a.editor.setSize(null,300),a.editor.on("change",function(){a.$emit(c.type+":editor:update")}),a.editor.on("dblclick",function(){a.$emit(c.type+":editor:dblclick")}),a.editorInit=!0}}}]),angular.module("tool-directives").directive("soapEditor",["$timeout",function(){return{restrict:"A",link:function(a,b,c){a.editor=CodeMirror.fromTextArea(document.getElementById(c.id),{lineNumbers:!0,fixedGutter:!0,mode:"xml",readOnly:void 0!=c.readonly&&c.readonly,showCursorWhenSelecting:!0}),a.editor.setSize(null,300),a.editor.on("dblclick",function(){a.$emit(c.type+":editor:dblclick")}),a.editorInit=!0}}}]),angular.module("tool-directives").directive("mypopover",["$compile","$templateCache",function(a,b){return{restrict:"A",link:function(a,c){var d=b.get("profileInfo.html"),e={content:d,placement:"bottom",html:!0};$(c).popover(e)}}}]),function(a){a.module("treeControl",[]).directive("treecontrol",["$compile",function(b){function c(a,b){return a?b?'class="'+a+'"':a:""}function d(a,b,c){a.hasOwnProperty(b)||(a[b]=c)}return{restrict:"EA",require:"treecontrol",transclude:!0,scope:{treeModel:"=",selectedNode:"=?",onSelection:"&",options:"=?"},controller:["$scope",function(e){e.options=e.options||{},d(e.options,"nodeChildren","children"),d(e.options,"dirSelectable","true"),d(e.options,"injectClasses",{}),d(e.options.injectClasses,"ul",""),d(e.options.injectClasses,"li",""),d(e.options.injectClasses,"liSelected",""),d(e.options.injectClasses,"iExpanded",""),d(e.options.injectClasses,"iCollapsed",""),d(e.options.injectClasses,"iLeaf",""),d(e.options.injectClasses,"label",""),d(e.options.injectClasses,"labelSelected",""),d(e.options,"equality",function(b,c){return void 0===b||void 0===c?!1:(b=a.copy(b),b[e.options.nodeChildren]=[],c=a.copy(c),c[e.options.nodeChildren]=[],a.equals(b,c))}),e.expandedNodes={},e.headClass=function(a){var b=c(e.options.injectClasses.liSelected,!1),d="";return b&&this.$id==e.selectedScope&&(d=" "+b),a[e.options.nodeChildren]&&0!==a[e.options.nodeChildren].length?e.expandedNodes[this.$id]?"tree-expanded"+d:"tree-collapsed"+d:"tree-leaf"+d},e.iBranchClass=function(){return c(e.expandedNodes[this.$id]?e.options.injectClasses.iExpanded:e.options.injectClasses.iCollapsed)},e.nodeExpanded=function(){return!!e.expandedNodes[this.$id]},e.selectNodeHead=function(){e.expandedNodes[this.$id]=void 0===e.expandedNodes[this.$id]?this.node:void 0},e.selectNodeLabel=function(a){a[e.options.nodeChildren]&&a[e.options.nodeChildren].length>0&&!e.options.dirSelectable?this.selectNodeHead():(e.selectedScope=this.$id,e.selectedNode=a,e.onSelection&&e.onSelection({node:a}))},e.selectedClass=function(){var a=c(e.options.injectClasses.labelSelected,!1),b="";return a&&this.$id==e.selectedScope&&(b=" "+a),this.$id==e.selectedScope?"tree-selected"+b:""};var f="<ul "+c(e.options.injectClasses.ul,!0)+'><li ng-repeat="node in node.'+e.options.nodeChildren+'" ng-class="headClass(node)" '+c(e.options.injectClasses.li,!0)+'><i class="tree-branch-head" ng-class="iBranchClass()" ng-click="selectNodeHead(node)"></i><i class="tree-leaf-head '+c(e.options.injectClasses.iLeaf,!1)+'"></i><div class="tree-label '+c(e.options.injectClasses.label,!1)+'" ng-class="selectedClass()" ng-click="selectNodeLabel(node)" tree-transclude></div><treeitem ng-if="nodeExpanded()"></treeitem></li></ul>';return{template:b(f)}}],compile:function(b,c,d){return function(b,c,e,f){b.$watch("treeModel",function(c){if(a.isArray(c)){if(a.isDefined(b.node)&&a.equals(b.node[b.options.nodeChildren],c))return;b.node={},b.node[b.options.nodeChildren]=c}else{if(a.equals(b.node,c))return;b.node=c}}),f.template(b,function(a){c.html("").append(a)}),b.$treeTransclude=d}}}}]).directive("treeitem",function(){return{restrict:"E",require:"^treecontrol",link:function(a,b,c,d){d.template(a,function(a){b.html("").append(a)})}}}).directive("treeTransclude",function(){return{link:function(b,c){a.forEach(b.expandedNodes,function(a,c){b.options.equality(a,b.node)&&(b.expandedNodes[b.$id]=b.node,b.expandedNodes[c]=void 0)}),b.options.equality(b.node,b.selectedNode)&&b.selectNodeLabel(b.node),b.$treeTransclude(b,function(a){c.empty(),c.append(a)})}}})}(angular),function(){var a;a=angular.module("angularBootstrapNavTree",[]),a.directive("abnTree",["$timeout",function(a){return{restrict:"E",template:'<ul class="nav nav-list nav-pills nav-stacked abn-tree cf-tree">\n  <li ng-repeat="row in tree_rows | filter:{visible:true} track by row.branch.uid" ng-animate="\'abn-tree-animate\'" ng-class="\'level-\' + {{ row.level }} + (row.branch.selected ? \' active\':\'\')" class="abn-tree-row">\n    <a ng-click="user_clicks_branch(row.branch)">\n      <i ng-class="row.tree_icon" ng-click="row.branch.expanded = !row.branch.expanded" class="indented tree-icon"> </i>\n      <span class="indented tree-label">{{ row.label }} </span>\n    </a>\n  </li>\n</ul>',replace:!0,scope:{treeData:"=",onSelect:"&",initialSelection:"@",treeControl:"="},link:function(b,c,d){var e,f,g,h,i,j,k,l,m,n,o;if(e=function(){return void 0},null==d.iconExpand&&(d.iconExpand="icon-plus  glyphicon glyphicon-plus  fa fa-plus"),null==d.iconCollapse&&(d.iconCollapse="icon-minus glyphicon glyphicon-minus fa fa-minus"),null==d.iconLeaf&&(d.iconLeaf="icon-file  glyphicon glyphicon-file  fa fa-file"),null==d.expandLevel&&(d.expandLevel="3"),g=parseInt(d.expandLevel,10),!b.treeData)return void alert("no treeData defined for the tree!");if(null==b.treeData.length){if(null==treeData.label)return void alert("treeData should be an array of root branches");b.treeData=[treeData]}return i=function(a){var c,d,e,f,g,h;for(c=function(b,d){var e,f,g,h,i;if(a(b,d),null!=b.children){for(h=b.children,i=[],f=0,g=h.length;g>f;f++)e=h[f],i.push(c(e,d+1));return i}},g=b.treeData,h=[],e=0,f=g.length;f>e;e++)d=g[e],h.push(c(d,1));return h},n=null,m=function(c){if(!c)return null!=n&&(n.selected=!1),void(n=null);if(c!==n){if(null!=n&&(n.selected=!1),c.selected=!0,n=c,f(c),null!=c.onSelect)return a(function(){return c.onSelect(c)});if(null!=b.onSelect)return a(function(){return b.onSelect({branch:c})})}},b.user_clicks_branch=function(a){return a!==n?m(a):void 0},j=function(a){var b;return b=void 0,a.parent_uid&&i(function(c){return c.uid===a.parent_uid?b=c:void 0}),b},h=function(a,b){var c;return c=j(a),null!=c?(b(c),h(c,b)):void 0},f=function(a){return h(a,function(a){return a.expanded=!0})},b.tree_rows=[],l=function(){var a,c,e,f,g,h;for(i(function(a){return a.uid?void 0:a.uid=""+Math.random()}),i(function(a){var b,c,d,e,f;if(angular.isArray(a.children)){for(e=a.children,f=[],c=0,d=e.length;d>c;c++)b=e[c],f.push(b.parent_uid=a.uid);return f}}),b.tree_rows=[],i(function(a){var b,c;return a.children?a.children.length>0?(c=function(a){return"string"==typeof a?{label:a,children:[]}:a},a.children=function(){var d,e,f,g;for(f=a.children,g=[],d=0,e=f.length;e>d;d++)b=f[d],g.push(c(b));return g}()):void 0:a.children=[]}),a=function(c,e,f){var g,h,i,j,k,l,m;if(null==e.expanded&&(e.expanded=!1),i=e.children&&0!==e.children.length?e.expanded?d.iconCollapse:d.iconExpand:d.iconLeaf,b.tree_rows.push({level:c,branch:e,label:e.label,tree_icon:i,visible:f}),null!=e.children){for(l=e.children,m=[],j=0,k=l.length;k>j;j++)g=l[j],h=f&&e.expanded,m.push(a(c+1,g,h));return m}},g=b.treeData,h=[],e=0,f=g.length;f>e;e++)c=g[e],h.push(a(1,c,!0));return h},b.$watch("treeData",l,!0),null!=d.initialSelection&&i(function(b){return b.label===d.initialSelection?a(function(){return m(b)}):void 0}),k=b.treeData.length,i(function(a,b){return a.level=b,a.expanded=a.level<g}),null!=b.treeControl&&angular.isObject(b.treeControl)?(o=b.treeControl,o.expand_all=function(){return i(function(a){return a.expanded=!0})},o.collapse_all=function(){return i(function(a){return a.expanded=!1})},o.get_first_branch=function(){return k=b.treeData.length,k>0?b.treeData[0]:void 0},o.select_first_branch=function(){var a;return a=o.get_first_branch(),o.select_branch(a)},o.get_selected_branch=function(){return n},o.get_parent_branch=function(a){return j(a)},o.select_branch=function(a){return m(a),a},o.get_children=function(a){return a.children},o.select_parent_branch=function(a){var b;return null==a&&(a=o.get_selected_branch()),null!=a&&(b=o.get_parent_branch(a),null!=b)?(o.select_branch(b),b):void 0},o.add_branch=function(a,c){return null!=a?(a.children.push(c),a.expanded=!0):b.treeData.push(c),c},o.add_root_branch=function(a){return o.add_branch(null,a),a},o.expand_branch=function(a){return null==a&&(a=o.get_selected_branch()),null!=a?(a.expanded=!0,a):void 0},o.collapse_branch=function(a){return null==a&&(a=n),null!=a?(a.expanded=!1,a):void 0},o.get_siblings=function(a){var c,d;return null==a&&(a=n),null!=a?(c=o.get_parent_branch(a),d=c?c.children:b.treeData):void 0},o.get_next_sibling=function(a){var b,c;return null==a&&(a=n),null!=a&&(c=o.get_siblings(a),k=c.length,b=c.indexOf(a),k>b)?c[b+1]:void 0},o.get_prev_sibling=function(a){var b,c;return null==a&&(a=n),c=o.get_siblings(a),k=c.length,b=c.indexOf(a),b>0?c[b-1]:void 0},o.select_next_sibling=function(a){var b;return null==a&&(a=n),null!=a&&(b=o.get_next_sibling(a),null!=b)?o.select_branch(b):void 0},o.select_prev_sibling=function(a){var b;return null==a&&(a=n),null!=a&&(b=o.get_prev_sibling(a),null!=b)?o.select_branch(b):void 0},o.get_first_child=function(a){var b;return null==a&&(a=n),null!=a&&(null!=(b=a.children)?b.length:void 0)>0?a.children[0]:void 0},o.get_closest_ancestor_next_sibling=function(a){var b,c;return b=o.get_next_sibling(a),null!=b?b:(c=o.get_parent_branch(a),o.get_closest_ancestor_next_sibling(c))},o.get_next_branch=function(a){var b;return null==a&&(a=n),null!=a?(b=o.get_first_child(a),null!=b?b:b=o.get_closest_ancestor_next_sibling(a)):void 0},o.select_next_branch=function(a){var b;return null==a&&(a=n),null!=a&&(b=o.get_next_branch(a),null!=b)?(o.select_branch(b),b):void 0},o.last_descendant=function(a){var b;return k=a.children.length,0===k?a:(b=a.children[k-1],o.last_descendant(b))},o.get_prev_branch=function(a){var b,c;return null==a&&(a=n),null!=a?(c=o.get_prev_sibling(a),null!=c?o.last_descendant(c):b=o.get_parent_branch(a)):void 0},o.select_prev_branch=function(a){var b;return null==a&&(a=n),null!=a&&(b=o.get_prev_branch(a),null!=b)?(o.select_branch(b),b):void 0}):void 0}}}])}.call(this),function(){var a;a=angular.module("treeGrid",[]),a.directive("treeGrid",["$timeout",function(a){return{restrict:"E",templateUrl:"lib/tree-grid/tree-grid-template.html",replace:!0,scope:{treeData:"=",colDefs:"=",expandOn:"=",onSelect:"&",initialSelection:"@",treeControl:"="},link:function(b,c,d){var e,f,g,h,i,j,k,l,m,n,o,p;if(e=function(){return void 0},null==d.iconExpand&&(d.iconExpand="icon-plus  glyphicon glyphicon-plus  fa fa-plus"),null==d.iconCollapse&&(d.iconCollapse="icon-minus glyphicon glyphicon-minus fa fa-minus"),null==d.iconLeaf&&(d.iconLeaf="icon-file  glyphicon glyphicon-file  fa fa-file"),null==d.expandLevel&&(d.expandLevel="2"),h=parseInt(d.expandLevel,10),!b.treeData)return void alert("no treeData defined for the tree!");if(null==b.treeData.length){if(null==treeData.label)return void alert("treeData should be an array of root branches");b.treeData=[treeData]}if(d.expandOn?(f=b.expandOn,b.expandingProperty=b.expandOn):b.treeData&&(b.expandingProperty="title",f="title"),d.colDefs)b.colDefinitions=b.colDefs;else{var q=[],r=b.treeData[0],s=["children","level","expanded",f];for(var t in r)-1==s.indexOf(t)&&q.push({field:t});b.colDefinitions=q}return j=function(a){var c,d,e,f,g,h;for(c=function(b,d){var e,f,g,h,i;if(a(b,d),null!=b.children){for(h=b.children,i=[],f=0,g=h.length;g>f;f++)e=h[f],i.push(c(e,d+1));return i}},g=b.treeData,h=[],e=0,f=g.length;f>e;e++)d=g[e],h.push(c(d,1));return h},o=null,n=function(c){if(!c)return null!=o&&(o.selected=!1),void(o=null);if(c!==o){if(null!=o&&(o.selected=!1),c.selected=!0,o=c,g(c),null!=c.onSelect)return a(function(){return c.onSelect(c)});if(null!=b.onSelect)return a(function(){return b.onSelect({branch:c})})}},b.user_clicks_branch=function(a){return a!==o?n(a):void 0},k=function(a){var b;return b=void 0,a.parent_uid&&j(function(c){return c.uid===a.parent_uid?b=c:void 0}),b},i=function(a,b){var c;return c=k(a),null!=c?(b(c),i(c,b)):void 0},g=function(a){return i(a,function(a){return a.expanded=!0})},b.tree_rows=[],m=function(){var a,c,e,g,h,i;for(j(function(a){return a.uid?void 0:a.uid=""+Math.random()}),j(function(a){var b,c,d,e,f;if(angular.isArray(a.children)){for(e=a.children,f=[],c=0,d=e.length;d>c;c++)b=e[c],f.push(b.parent_uid=a.uid);return f}}),b.tree_rows=[],j(function(a){var b,c;return a.children?a.children.length>0?(c=function(a){return"string"==typeof a?{label:a,children:[]}:a},a.children=function(){var d,e,f,g;for(f=a.children,g=[],d=0,e=f.length;e>d;d++)b=f[d],g.push(c(b));return g}()):void 0:a.children=[]}),a=function(c,e,g){var h,i,j,k,l,m,n;if(null==e.expanded&&(e.expanded=!1),j=e.children&&0!==e.children.length?e.expanded?d.iconCollapse:d.iconExpand:d.iconLeaf,e.level=c,b.tree_rows.push({level:c,branch:e,label:e[f],tree_icon:j,visible:g}),null!=e.children){for(m=e.children,n=[],k=0,l=m.length;l>k;k++)h=m[k],i=g&&e.expanded,n.push(a(c+1,h,i));return n}},h=b.treeData,i=[],e=0,g=h.length;g>e;e++)c=h[e],i.push(a(1,c,!0));return i},b.$watch("treeData",m,!0),null!=d.initialSelection&&j(function(b){return b.label===d.initialSelection?a(function(){return n(b)}):void 0}),l=b.treeData.length,j(function(a,b){return a.level=b,a.expanded=a.level<h}),null!=b.treeControl&&angular.isObject(b.treeControl)?(p=b.treeControl,p.expand_all=function(){return j(function(a){return a.expanded=!0})},p.collapse_all=function(){return j(function(a){return a.expanded=!1})},p.get_first_branch=function(){return l=b.treeData.length,l>0?b.treeData[0]:void 0},p.select_first_branch=function(){var a;return a=p.get_first_branch(),p.select_branch(a)},p.get_selected_branch=function(){return o},p.get_parent_branch=function(a){return k(a)},p.select_branch=function(a){return n(a),a},p.get_children=function(a){return a.children},p.select_parent_branch=function(a){var b;return null==a&&(a=p.get_selected_branch()),null!=a&&(b=p.get_parent_branch(a),null!=b)?(p.select_branch(b),b):void 0},p.add_branch=function(a,c){return null!=a?(a.children.push(c),a.expanded=!0):b.treeData.push(c),c},p.add_root_branch=function(a){return p.add_branch(null,a),a},p.expand_branch=function(a){return null==a&&(a=p.get_selected_branch()),null!=a?(a.expanded=!0,a):void 0},p.collapse_branch=function(a){return null==a&&(a=o),null!=a?(a.expanded=!1,a):void 0},p.get_siblings=function(a){var c,d;return null==a&&(a=o),null!=a?(c=p.get_parent_branch(a),d=c?c.children:b.treeData):void 0},p.get_next_sibling=function(a){var b,c;return null==a&&(a=o),null!=a&&(c=p.get_siblings(a),l=c.length,b=c.indexOf(a),l>b)?c[b+1]:void 0},p.get_prev_sibling=function(a){var b,c;return null==a&&(a=o),c=p.get_siblings(a),l=c.length,b=c.indexOf(a),b>0?c[b-1]:void 0},p.select_next_sibling=function(a){var b;return null==a&&(a=o),null!=a&&(b=p.get_next_sibling(a),null!=b)?p.select_branch(b):void 0},p.select_prev_sibling=function(a){var b;return null==a&&(a=o),null!=a&&(b=p.get_prev_sibling(a),null!=b)?p.select_branch(b):void 0},p.get_first_child=function(a){var b;return null==a&&(a=o),null!=a&&(null!=(b=a.children)?b.length:void 0)>0?a.children[0]:void 0},p.get_closest_ancestor_next_sibling=function(a){var b,c;return b=p.get_next_sibling(a),null!=b?b:(c=p.get_parent_branch(a),p.get_closest_ancestor_next_sibling(c))},p.get_next_branch=function(a){var b;return null==a&&(a=o),null!=a?(b=p.get_first_child(a),null!=b?b:b=p.get_closest_ancestor_next_sibling(a)):void 0},p.select_next_branch=function(a){var b;return null==a&&(a=o),null!=a&&(b=p.get_next_branch(a),null!=b)?(p.select_branch(b),b):void 0},p.last_descendant=function(a){var b;return l=a.children.length,0===l?a:(b=a.children[l-1],p.last_descendant(b))},p.get_prev_branch=function(a){var b,c;return null==a&&(a=o),null!=a?(c=p.get_prev_sibling(a),null!=c?p.last_descendant(c):b=p.get_parent_branch(a)):void 0},p.select_prev_branch=function(a){var b;return null==a&&(a=o),null!=a&&(b=p.get_prev_branch(a),null!=b)?(p.select_branch(b),b):void 0}):void 0}}}])}.call(this),function(){var a,b,c,d;a=jQuery,b=function(){function b(b,c,d){var e;this.row=b,this.tree=c,this.settings=d,this.id=this.row.data(this.settings.nodeIdAttr),e=this.row.data(this.settings.parentIdAttr),null!=e&&""!==e&&(this.parentId=e),this.treeCell=a(this.row.children(this.settings.columnElType)[this.settings.column]),this.expander=a(this.settings.expanderTemplate),this.indenter=a(this.settings.indenterTemplate),this.children=[],this.initialized=!1,this.treeCell.prepend(this.indenter)}return b.prototype.addChild=function(a){return this.children.push(a)},b.prototype.ancestors=function(){var a,b;for(b=this,a=[];b=b.parentNode();)a.push(b);return a},b.prototype.collapse=function(){return this.collapsed()?this:(this.row.removeClass("expanded").addClass("collapsed"),this._hideChildren(),this.expander.attr("title",this.settings.stringExpand),this.initialized&&null!=this.settings.onNodeCollapse&&this.settings.onNodeCollapse.apply(this),this)},b.prototype.collapsed=function(){return this.row.hasClass("collapsed")},b.prototype.expand=function(){return this.expanded()?this:(this.row.removeClass("collapsed").addClass("expanded"),this.initialized&&null!=this.settings.onNodeExpand&&this.settings.onNodeExpand.apply(this),a(this.row).is(":visible")&&this._showChildren(),this.expander.attr("title",this.settings.stringCollapse),this)},b.prototype.expanded=function(){return this.row.hasClass("expanded")},b.prototype.hide=function(){return this._hideChildren(),this.row.hide(),this},b.prototype.isBranchNode=function(){return this.children.length>0||this.row.data(this.settings.branchAttr)===!0?!0:!1},b.prototype.updateBranchLeafClass=function(){this.row.removeClass("branch"),this.row.removeClass("leaf"),this.row.addClass(this.isBranchNode()?"branch":"leaf")},b.prototype.level=function(){return this.ancestors().length},b.prototype.parentNode=function(){return null!=this.parentId?this.tree[this.parentId]:null},b.prototype.removeChild=function(b){var c=a.inArray(b,this.children);return this.children.splice(c,1)},b.prototype.render=function(){var b,c,d=this.settings;return d.expandable===!0&&this.isBranchNode()&&(b=function(b){return a(this).parents("table").treetable("node",a(this).parents("tr").data(d.nodeIdAttr)).toggle(),b.preventDefault()},this.indenter.html(this.expander),c=d.clickableNodeNames===!0?this.treeCell:this.expander,c.off("click.treetable").on("click.treetable",b),c.off("keydown.treetable").on("keydown.treetable",function(a){13==a.keyCode&&b.apply(this,[a])})),this.indenter[0].style.paddingLeft=""+this.level()*d.indent+"px",this},b.prototype.reveal=function(){return null!=this.parentId&&this.parentNode().reveal(),this.expand()},b.prototype.setParent=function(a){return null!=this.parentId&&this.tree[this.parentId].removeChild(this),this.parentId=a.id,this.row.data(this.settings.parentIdAttr,a.id),a.addChild(this)},b.prototype.show=function(){return this.initialized||this._initialize(),this.row.show(),this.expanded()&&this._showChildren(),this},b.prototype.toggle=function(){return this.expanded()?this.collapse():this.expand(),this},b.prototype._hideChildren=function(){var a,b,c,d,e;for(d=this.children,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.hide());return e},b.prototype._initialize=function(){var a=this.settings;return this.render(),a.expandable===!0&&"collapsed"===a.initialState?this.collapse():this.expand(),null!=a.onNodeInitialized&&a.onNodeInitialized.apply(this),this.initialized=!0},b.prototype._showChildren=function(){var a,b,c,d,e;for(d=this.children,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.show());return e},b}(),c=function(){function c(a,b){this.table=a,this.settings=b,this.tree={},this.nodes=[],this.roots=[]}return c.prototype.collapseAll=function(){var a,b,c,d,e;for(d=this.nodes,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.collapse());return e},c.prototype.expandAll=function(){var a,b,c,d,e;for(d=this.nodes,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(a.expand());return e},c.prototype.findLastNode=function(a){return a.children.length>0?this.findLastNode(a.children[a.children.length-1]):a},c.prototype.loadRows=function(c){var d,e,f;if(null!=c)for(f=0;f<c.length;f++)e=a(c[f]),null!=e.data(this.settings.nodeIdAttr)&&(d=new b(e,this.tree,this.settings),this.nodes.push(d),this.tree[d.id]=d,null!=d.parentId?this.tree[d.parentId].addChild(d):this.roots.push(d));for(f=0;f<this.nodes.length;f++)d=this.nodes[f].updateBranchLeafClass();return this},c.prototype.move=function(b,c){var d=b.parentNode();return b!==c&&c.id!==b.parentId&&-1===a.inArray(b,c.ancestors())&&(b.setParent(c),this._moveRows(b,c),1===b.parentNode().children.length&&b.parentNode().render()),d&&d.updateBranchLeafClass(),b.parentNode()&&b.parentNode().updateBranchLeafClass(),b.updateBranchLeafClass(),this},c.prototype.removeNode=function(b){this.unloadBranch(b),b.row.remove(),delete this.tree[b.id],this.nodes.splice(a.inArray(b,this.nodes),1)},c.prototype.render=function(){var a,b,c,d;for(d=this.roots,b=0,c=d.length;c>b;b++)a=d[b],a.show();return this},c.prototype.sortBranch=function(a,b){return a.children.sort(b),this._sortChildRows(a),this},c.prototype.unloadBranch=function(a){var b;for(b=0;b<a.children.length;b++)this.removeNode(a.children[b]);return a.children=[],a.updateBranchLeafClass(),this},c.prototype._moveRows=function(a,b){var c,d=a.children;for(a.row.insertAfter(b.row),a.render(),c=d.length-1;c>=0;c--)this._moveRows(d[c],a)},c.prototype._sortChildRows=function(a){return this._moveRows(a,a)},c}(),d={init:function(b,d){var e;return e=a.extend({branchAttr:"ttBranch",clickableNodeNames:!1,column:0,columnElType:"td",expandable:!1,expanderTemplate:"<a href='#'>&nbsp;</a>",indent:19,indenterTemplate:"<span class='indenter'></span>",initialState:"collapsed",nodeIdAttr:"ttId",parentIdAttr:"ttParentId",stringExpand:"Expand",stringCollapse:"Collapse",onInitialized:null,onNodeCollapse:null,onNodeExpand:null,onNodeInitialized:null},b),this.each(function(){var b,f=a(this);return(d||void 0===f.data("treetable"))&&(b=new c(this,e),b.loadRows(this.rows).render(),f.addClass("treetable").data("treetable",b),null!=e.onInitialized&&e.onInitialized.apply(b)),f})},destroy:function(){return this.each(function(){return a(this).removeData("treetable").removeClass("treetable")})},collapseAll:function(){return this.data("treetable").collapseAll(),this},collapseNode:function(a){var b=this.data("treetable").tree[a];if(!b)throw new Error("Unknown node '"+a+"'");return b.collapse(),this},expandAll:function(){return this.data("treetable").expandAll(),this},expandNode:function(a){var b=this.data("treetable").tree[a];if(!b)throw new Error("Unknown node '"+a+"'");return b.initialized||b._initialize(),b.expand(),this},loadBranch:function(b,c){var d=this.data("treetable").settings,e=this.data("treetable").tree;if(c=a(c),null==b)this.append(c);else{var f=this.data("treetable").findLastNode(b);c.insertAfter(f.row)}return this.data("treetable").loadRows(c),c.filter("tr").each(function(){e[a(this).data(d.nodeIdAttr)].show()}),null!=b&&b.render().expand(),this},move:function(a,b){var c,d;return d=this.data("treetable").tree[a],c=this.data("treetable").tree[b],this.data("treetable").move(d,c),this},node:function(a){return this.data("treetable").tree[a]},removeNode:function(a){var b=this.data("treetable").tree[a];if(!b)throw new Error("Unknown node '"+a+"'");return this.data("treetable").removeNode(b),this},reveal:function(a){var b=this.data("treetable").tree[a];if(!b)throw new Error("Unknown node '"+a+"'");return b.reveal(),this},sortBranch:function(b,c){var d,e=this.data("treetable").settings;return c=c||e.column,d=c,a.isNumeric(c)&&(d=function(b,d){var e,f,g;return e=function(b){var d=b.row.find("td:eq("+c+")").text();return a.trim(d).toUpperCase()},f=e(b),g=e(d),g>f?-1:f>g?1:0}),this.data("treetable").sortBranch(b,d),this},unloadBranch:function(a){return this.data("treetable").unloadBranch(a),this}},a.fn.treetable=function(b){return d[b]?d[b].apply(this,Array.prototype.slice.call(arguments,1)):"object"!=typeof b&&b?a.error("Method "+b+" does not exist on jQuery.treetable"):d.init.apply(this,arguments)},this.TreeTable||(this.TreeTable={}),this.TreeTable.Node=b,this.TreeTable.Tree=c}.call(this),!function(){angular.module("ngTreetable",[]).factory("ngTreetableParams",["$log",function(a){var b=function(b){var c=this;this.getNodes=function(){},this.getTemplate=function(){},this.options={},this.refresh=function(){},angular.isObject(b)&&angular.forEach(b,function(b,d){["getNodes","getTemplate","options"].indexOf(d)>-1?c[d]=b:a.warn('ngTreetableParams - Ignoring unexpected property "'+d+'".')})};return b}]).controller("TreetableController",["$scope","$element","$compile","$templateCache","$q","$http",function(a,b,c,d,e,f){var g=a.ttParams,h=b;a.compileElement=function(b,e,h){var i=(g.getTemplate(b),f.get(g.getTemplate(b),{cache:d}).then(function(a){return a.data}));return i.then(function(d){var f=a.$parent.$new();return angular.extend(f,{node:b,parentNode:h}),f._ttParentId=e,c(d)(f).get(0)})},a.addChildren=function(c,d){var f=c?c.scope().node:null,i=c?c.data("ttId"):null;c&&(c.scope().loading=!0),e.when(g.getNodes(f)).then(function(g){var j=[];angular.forEach(g,function(b){j.push(a.compileElement(b,i,f))}),e.all(j).then(function(e){var f=null!=i?h.treetable("node",i):null;b.treetable("loadBranch",f,e),d&&angular.forEach(e,function(b){a.addChildren($(b),d)}),c&&(c.scope().loading=!1)})})},a.onNodeExpand=function(){this.row.scope().loading||(h.treetable("unloadBranch",this),a.addChildren(this.row,a.shouldExpand()))},a.onNodeCollapse=function(){this.row.scope().loading||h.treetable("unloadBranch",this)},a.refresh=function(){for(var b=h.data("treetable").nodes;b.length>0;)h.treetable("removeNode",b[0].id);a.addChildren(null,a.shouldExpand())},g.refresh=a.refresh,a.getOptions=function(){var b=angular.extend({expandable:!0,onNodeExpand:a.onNodeExpand,onNodeCollapse:a.onNodeCollapse},g.options);return g.options&&angular.forEach(["onNodeCollapse","onNodeExpand"],function(c){g.options[c]&&(b[c]=function(){a[c].apply(this,arguments),g.options[c].apply(this,arguments)})}),b},a.shouldExpand=function(){return"expanded"===a.options.initialState},a.options=a.getOptions(),h.treetable(a.options),a.addChildren(null,a.shouldExpand())}]).directive("ttTable",[function(){return{restrict:"AC",scope:{ttParams:"="},controller:"TreetableController"}}]).directive("ttNode",[function(){var a=0;return{restrict:"AC",scope:{isBranch:"=",parent:"="},link:function(b,c){var d=angular.isDefined(b.isBranch)?b.isBranch:!0,e=angular.isDefined(b.parent)?b.parent:b.$parent._ttParentId;c.attr("data-tt-id",a++),c.attr("data-tt-branch",d),c.attr("data-tt-parent-id",e)}}}])}();
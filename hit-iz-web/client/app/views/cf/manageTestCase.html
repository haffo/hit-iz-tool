<style id="antiClickjack">body {
  display: none !important;
}</style>
<script type="text/javascript">
  if (self === top) {
    var antiClickjack = document.getElementById("antiClickjack");
    antiClickjack.parentNode.removeChild(antiClickjack);
  } else {
    top.location = self.location;
  }
</script>
<div class="container" ng-controller="CFTestManagementCtrl" ng-init="initManagement()">

  <div style="margin:10px" ng-show="isAuthenticated()">
    <div>
      <div class="row" ng-show="error != null && error != ''">
        <div class="col-md-12">
          <div class="alert alert-danger">{{error}}</div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12">
          <!-- Profile Errors -->
          <div class="panel panel-danger" ng-show="profileValidationErrors.length">
            <div class="panel-heading bold"><i style="font-size: 20px" class="fa fa-exclamation-triangle"
                                               aria-hidden="true"></i> Profile file error<span
              ng-show="profileValidationErrors.length >1">s</span></div>
            <table class="table  table-condensed table-bordered">
              <thead class="tbl-header-danger">
              <th style="width:50px;text-align: center;">#</th>
              <th colspan="2">Error</th>
              </thead>
              <tbody ng-repeat="error in profileValidationErrors track by $index">
              <tr>
                <td rowspan="3" style="text-align: center;">
                  {{$index +1}}
                </td>
                <td style="width:75px">
                  Row:
                </td>
                <td>
                  {{error.line}}
                </td>
              </tr>
              <tr>
                <td style="width:75px">
                  Column
                </td>
                <td>
                  {{error.column}}
                </td>
              </tr>
              <tr>
                <td style="width:75px">
                  Message
                </td>
                <td class="bold">
                  {{error.message}}
                </td>
              </tr>
              </tbody>
            </table>
          </div>

        </div>
        <div class="col-md-12">
          <!-- Value Set Errors -->
          <div class="panel panel-danger" ng-show="valueSetValidationErrors.length">
            <div class="panel-heading bold"><i style="font-size: 20px" class="fa fa-exclamation-triangle"
                                               aria-hidden="true"></i> Value set file error<span
              ng-show="valueSetValidationErrors.length >1">s</span></div>
            <table class="table  table-condensed table-bordered">
              <thead class="tbl-header-danger">
              <th style="width:50px;text-align: center;">#</th>
              <th colspan="2">Error</th>
              </thead>
              <tbody ng-repeat="error in valueSetValidationErrors track by $index">
              <tr>
                <td rowspan="3" style="text-align: center;">
                  {{$index +1}}
                </td>
                <td style="width:75px">
                  Row:
                </td>
                <td>
                  {{error.line}}
                </td>
              </tr>
              <tr>
                <td style="width:75px">
                  Column
                </td>
                <td>
                  {{error.column}}
                </td>
              </tr>
              <tr>
                <td style="width:75px">
                  Message
                </td>
                <td class="bold">
                  {{error.message}}
                </td>
              </tr>
              </tbody>
            </table>
          </div>
        </div>
        <div class="col-md-12">

          <!-- Constraint Errors -->
          <div class="panel panel-danger" ng-show="constraintValidationErrors.length">
            <div class="panel-heading bold"><i style="font-size: 20px" class="fa fa-exclamation-triangle"
                                               aria-hidden="true"></i> Contraints file error<span
              ng-show="constraintValidationErrors.length >1">s</span></div>
            <table class="table  table-condensed table-bordered">
              <thead class="tbl-header-danger">
              <th style="width:50px;text-align: center;">#</th>
              <th colspan="2">Error</th>
              </thead>
              <tbody ng-repeat="error in constraintValidationErrors track by $index">
              <tr>
                <td rowspan="3" style="text-align: center;">
                  {{$index +1}}
                </td>
                <td style="width:75px">
                  Row:
                </td>
                <td>
                  {{error.line}}
                </td>
              </tr>
              <tr>
                <td style="width:75px">
                  Column
                </td>
                <td>
                  {{error.column}}
                </td>
              </tr>
              <tr>
                <td style="width:75px">
                  Message
                </td>
                <td class="bold">
                  {{error.message}}
                </td>
              </tr>
              </tbody>
            </table>
          </div>

        </div>
        <div class="col-md-12">
          <!-- No Errors found in resource validation -->
          <div class="row">
            <div class="col-md-12" style="margin-bottom: 10px">
              <form class="form-inline">
                <div class="form-group">
                  <label class="control-label" style="text-align:left;" for="selectedScope">Profile Group Type: </label>

                  <div class="btn-group btn-group-md" id="selectedScope" role="group" aria-label="..." style="margin-right: 10px;">

                    <button  class="btn btn-cf-outline"   ng-repeat="tpScope in groupScopes" ng-click="selectedScope.key = tpScope.key; selectScope();"  ng-class="{'active':tpScope.key == selectedScope.key}"
                           >{{::tpScope.name}}
                    </button>

                  </div>



                  <!--<select class="form-control input-sm test-plan-select" style="width:200px;background-color: white;"-->
                          <!--name="selectedScope" id="selectedScope"-->
                          <!--ng-change="selectScope()"-->
                          <!--ng-model="selectedScope.key">-->
                    <!--<option value="">&#45;&#45;&#45;&#45; Select Type &#45;&#45;&#45;&#45;</option>-->
                    <!--<option ng-repeat="tpScope in groupScopes" ng-selected="tpScope.key == selectedScope.key"-->
                            <!--value="{{tpScope.key}}">{{::tpScope.name}}-->
                    <!--</option>-->
                  <!--</select>-->
                </div>
              </form>
            </div>
          </div>
          <div class="row">
            <div class="col-md-3">
              <div class="panel panel-default">
                <div class="panel-heading">Profile Groups
                  <button style="margin-right: 5px" class="pull-right btn btn-xs btn-success" ng-click="addNewCategory()"><i
                    class="fa fa-plus"></i></button>
                </div>
                <div class="panel-body">
                  <div ui-tree="treeOptions" id="tree-root">
                    <div ui-tree-nodes ng-model="categoryNodes">
                      <div class="panel panel-default" ng-repeat="node in categoryNodes" ui-tree-node>
                        <div class="panel-heading">
                          <i ng-if="node.nodes && node.nodes.length > 0" data-nodrag ng-click="toggle(this)" class="fa"
                             ng-class="{ 'fa-caret-right': collapsed,'fa-caret-down': !collapsed}"></i>
                          <span ng-if="node.edit">
                            <input id="catNemo" required name="name" data-nodrag ng-model="node.name" style="width:50%" ng-class="{'error': !isValidCategory(node)}">
                            <a title="Reset" class="btn btn-warning btn-xs" data-nodrag ng-click="resetCategory(node)"><span
                              class="fa fa-times"></span></a>
                            <a title="Save" class="btn btn-primary btn-xs" data-nodrag ng-click="saveCategory(node)"><span
                                class="fa fa-check"></span></a>
                          </span>

                          <span ng-if="!node.edit">
                             {{node.name}}
                            <span style="margin-left:5px">
                              <a class="point btn btn-default btn-xs" data-nodrag ng-click="editCategory(node)"><span
                                class="fa fa-pencil"></span></a>
                                  <a class="point btn btn-danger btn-xs" data-nodrag
                                     ng-click="deleteCategory(node)"><span
                                    class="fa fa-trash"></span></a>
                            </span>
                            </span>
                          <a class="point pull-right btn btn-success btn-xs" data-nodrag
                             ng-click="addNewGroup(node)"><span
                            class="fa fa-plus"></span></a>
                        </div>
                        <div  class="panel-body" ng-class="{hidden: collapsed}">
                          <ol ui-tree-nodes  ng-model="node.nodes">
                            <li ng-repeat="node in node.nodes" ui-tree-node ng-include="'cf_profile_group_render.html'">
                            </li>
                          </ol>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="col-md-9">
                <form name="tsForm" style="margin:0; padding:0; " ng-show="testcase != null || token != null">
                  <div class="row" style="margin-top:10px">
                    <div class="col-md-12">
                      <div class="panel panel-default">
                        <div class="panel-heading">Profile Group</div>
                        <div class="panel-body">
                          <div ng-show="testcase == null">
                            No Group Selected
                          </div>
                          <div ng-show="testcase != null">

                            <div class="row">
                              <div class="col-md-12">
                                <label for="testcasename">Name: <span class="red"
                                                                      title="required field">*</span></label>
                                <input id="testcasename" required name="name" ng-model="testcase.name"
                                       class="input-sm form-control ng-pristine ng-valid ng-empty ng-touched"><br>
                              </div>
                            </div>
                            <div class="row">

                              <div class="col-md-12">
                                <label for="testcasedescription">Description: <span class="red"
                                                                                    title="required field">*</span></label>
                                <textarea id="testcasedescription" required name="description"
                                          style="resize: vertical;"
                                          ng-model="testcase.description"
                                          class="form-control ng-pristine ng-valid ng-empty ng-touched"></textarea><br>
                              </div>

                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                    <div class="col-md-12">
                      <div class="panel panel-success">
                        <div class="panel-heading">New Profiles</div>
                        <div class="panel-body">
                        <span class="pull-right" style="margin-bottom:10px">
                        <button ng-show="getAddedProfiles() == null || getAddedProfiles().length == 0"
                                title="Upload Profiles" class="btn btn-sm btn-success" ng-click="openUploadModal()">
                            <i class="point fa fa-upload"></i> Upload Profiles
                          </button>
                        </span>
                          <table class="table table-striped table-condensed table-bordered"
                                 ng-show="tmpNewMessages != null && tmpNewMessages.length">
                            <thead class="">
                            <!--<th width="30px">-->
                            <!--<input ng-click="profileCheckToggle()" ng-model="profileCheckToggleStatus"-->
                            <!--ng-checked="{{profileCheckToggleStatus}}" type="checkbox">-->
                            <!--</th>-->
                            <th>Position</th>
                            <th>Name</th>
                            <th>Identifier</th>
                            <th>Description</th>
                            <th>Type</th>
                            <th>Event</th>
                            <th>StructID</th>
                            <th>Example Message</th>
                            <th>Action</th>
                            </thead>
                            <tbody>
                            <tr ng-repeat="item in tmpNewMessages | orderBy :'position'}">
                              <td>
                                <select ng-change="syncNewProfilesPositions(item)"
                                        ng-model="item.position" required ng-options="position for position in positions(tmpNewMessages)">
                                </select>
                              </td>
                              <td>
                                <input class="form-control" ng-model="item.name"
                                       ng-required="true" style="width: 100%;">
                              </td>
                              <td>
                                {{item.identifier}}
                              </td>
                              <td>
                                              <textarea style="resize: none;" class="form-control"
                                                        ng-model="item.description" rows="1"
                                                        ng-required="true" style="width: 100%;"></textarea>
                              </td>
                              <td>
                                {{item.type}}
                              </td>
                              <td>
                                {{item.event}}
                              </td>
                              <td>
                                {{item.structID}}
                              </td>

                              <td>
                                <span  ng-show="item.exampleMessage != undefined && item.exampleMessage != null && item.exampleMessage != ''" >
                                  <a class="point" ng-click="editExampleMessage(item)">Example Message
                                  </a>
                                  <button class="btn btn-xs btn-warning"  class="point" ng-click="item.exampleMessage = ''">
                                     <i class="fa fa-times"></i>
                                  </button>
                                </span>

                                <button ng-show="item.exampleMessage == null || item.exampleMessage == undefined ||  item.exampleMessage == ''" class="btn btn-xs btn-info" ng-click="editExampleMessage(item)"><i
                                  class="fa fa-plus"></i>
                                </button>
                              </td>


                              <td>
                                <button class="btn btn-sm btn-danger" ng-click="deleteNewProfile(item)"><i
                                  class="fa fa-trash"></i>
                                </button>
                              </td>
                            </tr>
                            </tbody>
                          </table>
                        </div>
                      </div>
                    </div>

                    <div class="col-md-12" ng-if="tmpOldMessages != null">
                      <div class="panel panel-default">
                        <div class="panel-heading">Existing Profiles
                        </div>
                        <div class="panel-body">
                          <div ng-if="tmpOldMessages.length > 0">
                            <table class="table table-striped table-condensed table-bordered">
                              <thead class="">
                              <th>Position</th>
                              <th>Name</th>
                              <th>Description</th>
                              <th>Example Message</th>
                              <th>Actions</th>
                              </thead>
                              <tbody>
                              <tr ng-repeat="item in tmpOldMessages | orderBy :'position'">
                                <td>
                                  <select ng-change="syncOldProfilesPositions(item)"
                                    ng-model="item.position" required ng-options="position for position in positions(tmpOldMessages)">
                                  </select>
                                </td>
                                <td>
                                  <input ng-model="item.name" class="form-control"
                                         ng-required="true" style="width: 100%;">
                                </td>
                                <td>
                                           <textarea style="resize: none;" class="form-control"
                                                     ng-model="item.description" rows="1"
                                                     ng-required="true" style="width: 100%;"></textarea>
                                </td>
                                <td>
                                 <span  ng-show="item.exampleMessage != undefined && item.exampleMessage != null && item.exampleMessage != ''" >
                                  <a class="point" ng-click="editExampleMessage(item)">Example Message
                                  </a>
                                  <button class="btn btn-xs btn-warning"  class="point" ng-click="item.exampleMessage = ''">
                                     <i class="fa fa-times"></i>
                                  </button>
                                </span>

                                  <button ng-show="item.exampleMessage == null || item.exampleMessage == undefined ||  item.exampleMessage == ''" class="btn btn-xs btn-info" ng-click="editExampleMessage(item)"><i
                                    class="fa fa-plus"></i>
                                  </button>
                                </td>
                                <td>
                                  <button class="btn btn-sm btn-danger" ng-click="deleteOldProfile(item)"><i
                                    class="fa fa-trash"></i>
                                  </button>
                                </td>
                              </tr>
                              </tbody>
                            </table>
                          </div>
                          <div ng-if="oldProfileMessages == null || oldProfileMessages.length == 0">
                            No existing profiles.
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                  <br>
                  <div  ng-if="testcase != null">


                  <div style="text-align:right">


                    <button class="btn btn-md btn-warning" ng-disabled="loading" ng-click="reset()"><i class="fa fa-times"></i>Reset</button>

                    <button type="button" class="btn btn-md btn-success" ng-click="saveGroup()"

                            ng-disabled="tsForm.$invalid || loading">
                      <i class="fa fa-check"></i> Save
                    </button>

                    <button ng-show="testcase.scope === 'USER' && (isAdmin() || isSupervisor())" type="button" class="btn btn-md btn-primary" ng-click="publishGroup()"
                            ng-disabled="tsForm.$invalid || loading">
                      <i class="fa fa-paper-plane"></i> Publish
                    </button>

                    <button class="btn btn-md btn-danger"  ng-disabled="loading" ng-click="deleteGroup(testcase.groupId)"><i class="fa fa-trash"></i>Delete</button>


                  </div>

                  <div ng-show="loading" style="text-align:center">
                    <i class="fa fa-circle-o-notch fa-spin fa-2x"></i>
                  </div>



                    <div ng-show="executionError != null && executionError != ''">
                         <div class="alert alert-danger">{{executionError}}</div>
                     </div>



                  </div>

                </form>
              </div>
            </div>
          </div>
        </div>

      </div>
    </div>
  </div>


</div>


